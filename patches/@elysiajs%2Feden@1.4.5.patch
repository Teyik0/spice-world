diff --git a/dist/chunk-LJDYVDXQ.mjs b/Users/teyik0/.bun/install/cache/@elysiajs/eden@1.4.5@@@1/dist/chunk-LJDYVDXQ.mjs
deleted file mode 100644
index ea11206b04e7f12a496fc5fb3fc253987b3fa5b3..0000000000000000000000000000000000000000
diff --git a/node_modules/@elysiajs/eden/dist/chunk-YANFU6C4.mjs b/dist/chunk-YANFU6C4.mjs
new file mode 100644
index 0000000000000000000000000000000000000000..e8ae7df477d2f1b06389245193bcd1b27eb2a953
--- /dev/null
+++ b/dist/chunk-YANFU6C4.mjs
@@ -0,0 +1,6 @@
+import{a as C,b as I,c as L,d as D}from"./chunk-QSLHAOSM.mjs";var K=class{constructor(t){this.url=t;this.ws=new WebSocket(t)}ws;send(t){return Array.isArray(t)?(t.forEach(n=>this.send(n)),this):(this.ws.send(typeof t=="object"?JSON.stringify(t):t.toString()),this)}on(t,n,s){return this.addEventListener(t,n,s)}off(t,n,s){return this.ws.removeEventListener(t,n,s),this}subscribe(t,n){return this.addEventListener("message",t,n)}addEventListener(t,n,s){return this.ws.addEventListener(t,f=>{if(t==="message"){let a=D(f);n({...f,data:a})}else n(f)},s),this}removeEventListener(t,n,s){return this.off(t,n,s),this}close(){return this.ws.close(),this}};var B=["get","post","put","delete","patch","options","head","connect","subscribe"],J=["localhost","127.0.0.1","0.0.0.0"],N=typeof FileList>"u",T=e=>N?e instanceof Blob:e instanceof FileList||e instanceof File,V=e=>{if(!e)return!1;for(let t in e)if(T(e[t])||Array.isArray(e[t])&&e[t].find(T))return!0;return!1},M=e=>N?e:new Promise(t=>{let n=new FileReader;n.onload=()=>{let s=new File([n.result],e.name,{lastModified:e.lastModified,type:e.type});t(s)},n.readAsArrayBuffer(e)}),v=(e,t,n={},s={})=>{if(Array.isArray(e)){for(let f of e)if(!Array.isArray(f))s=v(f,t,n,s);else{let a=f[0];if(typeof a=="string")s[a.toLowerCase()]=f[1];else for(let[i,h]of a)s[i.toLowerCase()]=h}return s}if(!e)return s;switch(typeof e){case"function":if(e instanceof Headers)return v(e,t,n,s);let f=e(t,n);return f?v(f,t,n,s):s;case"object":if(e instanceof Headers)return e.forEach((a,i)=>{s[i.toLowerCase()]=a}),s;for(let[a,i]of Object.entries(e))s[a.toLowerCase()]=i;return s;default:return s}};async function*$(e){let t=e.body;if(!t)return;let n=t.getReader(),s=new TextDecoder;try{for(;;){let{done:f,value:a}=await n.read();if(f)break;let i=typeof a=="string"?a:s.decode(a);i.includes(`
+
+`)?yield*G(i):yield L(i)}}finally{n.releaseLock()}}function*G(e){let t=e.split(`
+
+`);for(let n of t){if(n.indexOf(":")<=0){n&&(yield L(n));continue}let s=n.split(`
+`),f={};for(let a of s){let i=a.indexOf(":");if(i>0){let h=a.slice(0,i).trim(),j=a.slice(i+1).trim();f[h]=L(j)}}yield f}}var R=(e,t,n=[],s)=>new Proxy(()=>{},{get(f,a){return R(e,t,a==="index"?n:[...n,a],s)},apply(f,a,[i,h]){if(!i||h||typeof i=="object"&&Object.keys(i).length!==1||B.includes(n.at(-1))){let j=[...n],A=j.pop(),m="/"+j.join("/"),{fetcher:P=fetch,headers:F,onRequest:w,onResponse:O,fetch:H}=t,S=A==="get"||A==="head"||A==="subscribe";F=v(F,m,h);let q=S?i?.query:h?.query,W="";if(q){let r=(b,p)=>{W+=(W?"&":"?")+`${encodeURIComponent(b)}=${encodeURIComponent(p)}`};for(let[b,p]of Object.entries(q)){if(Array.isArray(p)){for(let y of p)r(b,y);continue}if(p!=null){if(typeof p=="object"){r(b,JSON.stringify(p));continue}r(b,`${p}`)}}}if(A==="subscribe"){let r=e.replace(/^([^]+):\/\//,e.startsWith("https://")?"wss://":e.startsWith("http://")||J.find(b=>e.includes(b))?"ws://":"wss://")+m+W;return new K(r)}return(async()=>{let r={method:A?.toUpperCase(),body:i,...H,headers:F};r.headers={...F,...v(S?i?.headers:h?.headers,m,r)};let b=S&&typeof i=="object"?i.fetch:h?.fetch;if(r={...r,...b},S&&delete r.body,w){Array.isArray(w)||(w=[w]);for(let l of w){let c=await l(m,r);typeof c=="object"&&(r={...r,...c,headers:{...r.headers,...v(c.headers,m,r)}})}}if(S&&delete r.body,V(i)){let l=new FormData,c=o=>typeof o=="string"||T(o)?!1:typeof o=="object"&&o!==null,g=async o=>o instanceof File?await M(o):c(o)?JSON.stringify(o):o;for(let[o,u]of Object.entries(r.body)){if(Array.isArray(u)){if(u.some(k=>typeof k=="object"&&k!==null&&!T(k)))l.append(o,JSON.stringify(u));else for(let k=0;k<u.length;k++){let U=u[k],_=await g(U);l.append(o,_)}continue}if(N){if(Array.isArray(u))for(let E of u)l.append(o,await g(E));else l.append(o,await g(u));continue}if(u instanceof File){l.append(o,await M(u));continue}if(u instanceof FileList){for(let E=0;E<u.length;E++)l.append(o,await M(u[E]));continue}l.append(o,await g(u))}r.body=l}else typeof i=="object"?(r.headers["content-type"]="application/json",r.body=JSON.stringify(i)):i!=null&&(r.headers["content-type"]="text/plain");if(S&&delete r.body,w){Array.isArray(w)||(w=[w]);for(let l of w){let c=await l(m,r);typeof c=="object"&&(r={...r,...c,headers:{...r.headers,...v(c.headers,m,r)}})}}h?.headers?.["content-type"]&&(r.headers["content-type"]=h?.headers["content-type"]);let p=e+m+W,y=await(s?.handle(new Request(p,r))??P(p,r)),d=null,x=null;if(O){Array.isArray(O)||(O=[O]);for(let l of O)try{let c=await l(y.clone());if(c!=null){d=c;break}}catch(c){c instanceof C?x=c:x=new C(422,c);break}}if(d!==null)return{data:d,error:x,response:y,status:y.status,headers:y.headers};switch(y.headers.get("Content-Type")?.split(";")[0]){case"text/event-stream":d=$(y);break;case"application/json":d=JSON.parse(await y.text(),(c,g)=>{if(typeof g!="string")return g;let o=I(g);return o||g});break;case"application/octet-stream":d=await y.arrayBuffer();break;case"multipart/form-data":let l=await y.formData();d={},l.forEach((c,g)=>{d[g]=c});break;default:d=await y.text().then(L)}return(y.status>=300||y.status<200)&&(x=new C(y.status,d),d=null),{data:d,error:x,response:y,status:y.status,headers:y.headers}})()}return typeof i=="object"?R(e,t,[...n,Object.values(i)[0]],s):R(e,t,n)}}),ee=(e,t={})=>typeof e=="string"?(t.keepDomain||(e.includes("://")||(e=(J.find(n=>e.includes(n))?"http://":"https://")+e),e.endsWith("/")&&(e=e.slice(0,-1))),R(e,t)):(typeof window<"u"&&console.warn("Elysia instance server found on client side, this is not recommended for security reason. Use generic type instead."),R("http://e.ly",t,[],e));export{$ as a,ee as b};
diff --git a/dist/index.d.mts b/dist/index.d.mts
index 8193f3a00fc74d67eb8dc8688a836c7d5cfdff27..3fe2ec59ac2f52488b087b4f9f7498c2c1a4ca41 100644
--- a/dist/index.d.mts
+++ b/dist/index.d.mts
@@ -3,3 +3,4 @@ export { edenTreaty } from './treaty.mjs';
 export { edenFetch } from './fetch.mjs';
 export { E as EdenFetchError } from './types-BdHMTa_C.mjs';
 import 'elysia';
+import 'bun';
diff --git a/dist/index.d.ts b/dist/index.d.ts
index 8997ae9b2d6a0c1573ec977dc609a4dc78599ec0..1ae68c4616e8ab0d8d4c3a2a4584ec9f5935352e 100644
--- a/dist/index.d.ts
+++ b/dist/index.d.ts
@@ -3,3 +3,4 @@ export { edenTreaty } from './treaty.js';
 export { edenFetch } from './fetch.js';
 export { E as EdenFetchError } from './types-BdHMTa_C.js';
 import 'elysia';
+import 'bun';
diff --git a/dist/index.global.js b/dist/index.global.js
index 1d5c29d3f47f0f46fd35a57d24bba99007a572a1..3fcf41b5bc831bf63cccd686cbfab97909f30ba5 100644
--- a/dist/index.global.js
+++ b/dist/index.global.js
@@ -1,6 +1,6 @@
-"use strict";var Eden=(()=>{var J=Object.defineProperty;var ne=Object.getOwnPropertyDescriptor;var re=Object.getOwnPropertyNames;var se=Object.prototype.hasOwnProperty;var ae=(e,t)=>{for(var n in t)J(e,n,{get:t[n],enumerable:!0})},ie=(e,t,n,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let a of re(t))!se.call(e,a)&&a!==n&&J(e,a,{get:()=>t[a],enumerable:!(r=ne(t,a))||r.enumerable});return e};var oe=e=>ie(J({},"__esModule",{value:!0}),e);var Se={};ae(Se,{EdenFetchError:()=>x,edenFetch:()=>te,edenTreaty:()=>ee,treaty:()=>Q});var x=class extends Error{constructor(n,r){super(r+"");this.status=n;this.value=r}};var ce=/(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))/,fe=/(?:Sun|Mon|Tue|Wed|Thu|Fri|Sat)\s(?:Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s\d{2}\s\d{4}\s\d{2}:\d{2}:\d{2}\sGMT(?:\+|-)\d{4}\s\([^)]+\)/,de=/^(?:(?:(?:(?:0?[1-9]|[12][0-9]|3[01])[/\s-](?:0?[1-9]|1[0-2])[/\s-](?:19|20)\d{2})|(?:(?:19|20)\d{2}[/\s-](?:0?[1-9]|1[0-2])[/\s-](?:0?[1-9]|[12][0-9]|3[01]))))(?:\s(?:1[012]|0?[1-9]):[0-5][0-9](?::[0-5][0-9])?(?:\s[AP]M)?)?$/,ye=e=>e.trim().length!==0&&!Number.isNaN(Number(e)),D=e=>{if(typeof e!="string")return null;let t=e.replace(/"/g,"");if(ce.test(t)||fe.test(t)||de.test(t)){let n=new Date(t);if(!Number.isNaN(n.getTime()))return n}return null},ue=e=>{let t=e.charCodeAt(0),n=e.charCodeAt(e.length-1);return t===123&&n===125||t===91&&n===93},le=e=>JSON.parse(e,(t,n)=>{let r=D(n);return r||n}),L=e=>{if(!e)return e;if(ye(e))return+e;if(e==="true")return!0;if(e==="false")return!1;let t=D(e);if(t)return t;if(ue(e))try{return le(e)}catch{}return e},I=e=>{let t=e.data.toString();return t==="null"?null:L(t)};var P=class{constructor(t){this.url=t;this.ws=new WebSocket(t)}ws;send(t){return Array.isArray(t)?(t.forEach(n=>this.send(n)),this):(this.ws.send(typeof t=="object"?JSON.stringify(t):t.toString()),this)}on(t,n,r){return this.addEventListener(t,n,r)}off(t,n,r){return this.ws.removeEventListener(t,n,r),this}subscribe(t,n){return this.addEventListener("message",t,n)}addEventListener(t,n,r){return this.ws.addEventListener(t,a=>{if(t==="message"){let s=I(a);n({...a,data:s})}else n(a)},r),this}removeEventListener(t,n,r){return this.off(t,n,r),this}close(){return this.ws.close(),this}};var pe=["get","post","put","delete","patch","options","head","connect","subscribe"],Z=["localhost","127.0.0.1","0.0.0.0"],H=typeof FileList>"u",G=e=>H?e instanceof Blob:e instanceof FileList||e instanceof File,he=e=>{if(!e)return!1;for(let t in e)if(G(e[t])||Array.isArray(e[t])&&e[t].find(G))return!0;return!1},U=e=>H?e:new Promise(t=>{let n=new FileReader;n.onload=()=>{let r=new File([n.result],e.name,{lastModified:e.lastModified,type:e.type});t(r)},n.readAsArrayBuffer(e)}),M=(e,t,n={},r={})=>{if(Array.isArray(e)){for(let a of e)if(!Array.isArray(a))r=M(a,t,n,r);else{let s=a[0];if(typeof s=="string")r[s.toLowerCase()]=a[1];else for(let[i,y]of s)r[i.toLowerCase()]=y}return r}if(!e)return r;switch(typeof e){case"function":if(e instanceof Headers)return M(e,t,n,r);let a=e(t,n);return a?M(a,t,n,r):r;case"object":if(e instanceof Headers)return e.forEach((s,i)=>{r[i.toLowerCase()]=s}),r;for(let[s,i]of Object.entries(e))r[s.toLowerCase()]=i;return r;default:return r}};async function*ge(e){let t=e.body;if(!t)return;let n=t.getReader(),r=new TextDecoder;try{for(;;){let{done:a,value:s}=await n.read();if(a)break;let i=typeof s=="string"?s:r.decode(s);i.includes(`
+"use strict";var Eden=(()=>{var U=Object.defineProperty;var ne=Object.getOwnPropertyDescriptor;var re=Object.getOwnPropertyNames;var se=Object.prototype.hasOwnProperty;var ae=(e,t)=>{for(var n in t)U(e,n,{get:t[n],enumerable:!0})},ie=(e,t,n,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let a of re(t))!se.call(e,a)&&a!==n&&U(e,a,{get:()=>t[a],enumerable:!(r=ne(t,a))||r.enumerable});return e};var oe=e=>ie(U({},"__esModule",{value:!0}),e);var Se={};ae(Se,{EdenFetchError:()=>T,edenFetch:()=>te,edenTreaty:()=>ee,treaty:()=>Q});var T=class extends Error{constructor(n,r){super(r+"");this.status=n;this.value=r}};var ce=/(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))/,fe=/(?:Sun|Mon|Tue|Wed|Thu|Fri|Sat)\s(?:Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s\d{2}\s\d{4}\s\d{2}:\d{2}:\d{2}\sGMT(?:\+|-)\d{4}\s\([^)]+\)/,de=/^(?:(?:(?:(?:0?[1-9]|[12][0-9]|3[01])[/\s-](?:0?[1-9]|1[0-2])[/\s-](?:19|20)\d{2})|(?:(?:19|20)\d{2}[/\s-](?:0?[1-9]|1[0-2])[/\s-](?:0?[1-9]|[12][0-9]|3[01]))))(?:\s(?:1[012]|0?[1-9]):[0-5][0-9](?::[0-5][0-9])?(?:\s[AP]M)?)?$/,ye=e=>e.trim().length!==0&&!Number.isNaN(Number(e)),D=e=>{if(typeof e!="string")return null;let t=e.replace(/"/g,"");if(ce.test(t)||fe.test(t)||de.test(t)){let n=new Date(t);if(!Number.isNaN(n.getTime()))return n}return null},ue=e=>{let t=e.charCodeAt(0),n=e.charCodeAt(e.length-1);return t===123&&n===125||t===91&&n===93},le=e=>JSON.parse(e,(t,n)=>{let r=D(n);return r||n}),W=e=>{if(!e)return e;if(ye(e))return+e;if(e==="true")return!0;if(e==="false")return!1;let t=D(e);if(t)return t;if(ue(e))try{return le(e)}catch{}return e},I=e=>{let t=e.data.toString();return t==="null"?null:W(t)};var P=class{constructor(t){this.url=t;this.ws=new WebSocket(t)}ws;send(t){return Array.isArray(t)?(t.forEach(n=>this.send(n)),this):(this.ws.send(typeof t=="object"?JSON.stringify(t):t.toString()),this)}on(t,n,r){return this.addEventListener(t,n,r)}off(t,n,r){return this.ws.removeEventListener(t,n,r),this}subscribe(t,n){return this.addEventListener("message",t,n)}addEventListener(t,n,r){return this.ws.addEventListener(t,a=>{if(t==="message"){let s=I(a);n({...a,data:s})}else n(a)},r),this}removeEventListener(t,n,r){return this.off(t,n,r),this}close(){return this.ws.close(),this}};var pe=["get","post","put","delete","patch","options","head","connect","subscribe"],Z=["localhost","127.0.0.1","0.0.0.0"],H=typeof FileList>"u",q=e=>H?e instanceof Blob:e instanceof FileList||e instanceof File,he=e=>{if(!e)return!1;for(let t in e)if(q(e[t])||Array.isArray(e[t])&&e[t].find(q))return!0;return!1},V=e=>H?e:new Promise(t=>{let n=new FileReader;n.onload=()=>{let r=new File([n.result],e.name,{lastModified:e.lastModified,type:e.type});t(r)},n.readAsArrayBuffer(e)}),C=(e,t,n={},r={})=>{if(Array.isArray(e)){for(let a of e)if(!Array.isArray(a))r=C(a,t,n,r);else{let s=a[0];if(typeof s=="string")r[s.toLowerCase()]=a[1];else for(let[i,u]of s)r[i.toLowerCase()]=u}return r}if(!e)return r;switch(typeof e){case"function":if(e instanceof Headers)return C(e,t,n,r);let a=e(t,n);return a?C(a,t,n,r):r;case"object":if(e instanceof Headers)return e.forEach((s,i)=>{r[i.toLowerCase()]=s}),r;for(let[s,i]of Object.entries(e))r[s.toLowerCase()]=i;return r;default:return r}};async function*ge(e){let t=e.body;if(!t)return;let n=t.getReader(),r=new TextDecoder;try{for(;;){let{done:a,value:s}=await n.read();if(a)break;let i=typeof s=="string"?s:r.decode(s);i.includes(`
 
-`)?yield*me(i):yield L(i)}}finally{n.releaseLock()}}function*me(e){let t=e.split(`
+`)?yield*me(i):yield W(i)}}finally{n.releaseLock()}}function*me(e){let t=e.split(`
 
-`);for(let n of t){if(n.indexOf(":")<=0){n&&(yield L(n));continue}let r=n.split(`
-`),a={};for(let s of r){let i=s.indexOf(":");if(i>0){let y=s.slice(0,i).trim(),j=s.slice(i+1).trim();a[y]=L(j)}}yield a}}var K=(e,t,n=[],r)=>new Proxy(()=>{},{get(a,s){return K(e,t,s==="index"?n:[...n,s],r)},apply(a,s,[i,y]){if(!i||y||typeof i=="object"&&Object.keys(i).length!==1||pe.includes(n.at(-1))){let j=[...n],k=j.pop(),w="/"+j.join("/"),{fetcher:T=fetch,headers:F,onRequest:m,onResponse:b,fetch:S}=t,h=k==="get"||k==="head"||k==="subscribe";F=M(F,w,y);let N=h?i?.query:y?.query,v="";if(N){let o=(O,E)=>{v+=(v?"&":"?")+`${encodeURIComponent(O)}=${encodeURIComponent(E)}`};for(let[O,E]of Object.entries(N)){if(Array.isArray(E)){for(let c of E)o(O,c);continue}if(E!=null){if(typeof E=="object"){o(O,JSON.stringify(E));continue}o(O,`${E}`)}}}if(k==="subscribe"){let o=e.replace(/^([^]+):\/\//,e.startsWith("https://")?"wss://":e.startsWith("http://")||Z.find(O=>e.includes(O))?"ws://":"wss://")+w+v;return new P(o)}return(async()=>{let o={method:k?.toUpperCase(),body:i,...S,headers:F};o.headers={...F,...M(h?i?.headers:y?.headers,w,o)};let O=h&&typeof i=="object"?i.fetch:y?.fetch;if(o={...o,...O},h&&delete o.body,m){Array.isArray(m)||(m=[m]);for(let u of m){let f=await u(w,o);typeof f=="object"&&(o={...o,...f,headers:{...o.headers,...M(f.headers,w,o)}})}}if(h&&delete o.body,he(i)){let u=new FormData;for(let[f,d]of Object.entries(o.body)){if(Array.isArray(d)){for(let l=0;l<d.length;l++){let A=d[l];u.append(f,A instanceof File?await U(A):A)}continue}if(H){if(Array.isArray(d))for(let l of d)u.append(f,l);else u.append(f,d);continue}if(d instanceof File){u.append(f,await U(d));continue}if(d instanceof FileList){for(let l=0;l<d.length;l++)u.append(f,await U(d[l]));continue}u.append(f,d)}o.body=u}else typeof i=="object"?(o.headers["content-type"]="application/json",o.body=JSON.stringify(i)):i!=null&&(o.headers["content-type"]="text/plain");if(h&&delete o.body,m){Array.isArray(m)||(m=[m]);for(let u of m){let f=await u(w,o);typeof f=="object"&&(o={...o,...f,headers:{...o.headers,...M(f.headers,w,o)}})}}y?.headers?.["content-type"]&&(o.headers["content-type"]=y?.headers["content-type"]);let E=e+w+v,c=await(r?.handle(new Request(E,o))??T(E,o)),g=null,p=null;if(b){Array.isArray(b)||(b=[b]);for(let u of b)try{let f=await u(c.clone());if(f!=null){g=f;break}}catch(f){f instanceof x?p=f:p=new x(422,f);break}}if(g!==null)return{data:g,error:p,response:c,status:c.status,headers:c.headers};switch(c.headers.get("Content-Type")?.split(";")[0]){case"text/event-stream":g=ge(c);break;case"application/json":g=JSON.parse(await c.text(),(f,d)=>{if(typeof d!="string")return d;let l=D(d);return l||d});break;case"application/octet-stream":g=await c.arrayBuffer();break;case"multipart/form-data":let u=await c.formData();g={},u.forEach((f,d)=>{g[d]=f});break;default:g=await c.text().then(L)}return(c.status>=300||c.status<200)&&(p=new x(c.status,g),g=null),{data:g,error:p,response:c,status:c.status,headers:c.headers}})()}return typeof i=="object"?K(e,t,[...n,Object.values(i)[0]],r):K(e,t,n)}}),Q=(e,t={})=>typeof e=="string"?(t.keepDomain||(e.includes("://")||(e=(Z.find(n=>e.includes(n))?"http://":"https://")+e),e.endsWith("/")&&(e=e.slice(0,-1))),K(e,t)):(typeof window<"u"&&console.warn("Elysia instance server found on client side, this is not recommended for security reason. Use generic type instead."),K("http://e.ly",t,[],e));var z=(e,t,n)=>{if(e.endsWith("/")||(e+="/"),t==="index"&&(t=""),!n||!Object.keys(n).length)return`${e}${t}`;let r="";for(let[a,s]of Object.entries(n))r+=`${a}=${s}&`;return`${e}${t}?${r.slice(0,-1)}`};var V=typeof FileList>"u",X=e=>V?e instanceof Blob:e instanceof FileList||e instanceof File,Ee=e=>{if(!e)return!1;for(let t in e){if(X(e[t]))return!0;if(Array.isArray(e[t])&&e[t].find(n=>X(n)))return!0}return!1},_=e=>V?e:new Promise(t=>{let n=new FileReader;n.onload=()=>{let r=new File([n.result],e.name,{lastModified:e.lastModified,type:e.type});t(r)},n.readAsArrayBuffer(e)}),B=class{ws;url;constructor(t){this.ws=new WebSocket(t),this.url=t}send(t){return Array.isArray(t)?(t.forEach(n=>this.send(n)),this):(this.ws.send(typeof t=="object"?JSON.stringify(t):t.toString()),this)}on(t,n,r){return this.addEventListener(t,n,r)}off(t,n,r){return this.ws.removeEventListener(t,n,r),this}subscribe(t,n){return this.addEventListener("message",t,n)}addEventListener(t,n,r){return this.ws.addEventListener(t,a=>{if(t==="message"){let s=I(a);n({...a,data:s})}else n(a)},r),this}removeEventListener(t,n,r){return this.off(t,n,r),this}close(){return this.ws.close(),this}},Y=(e,t="",n)=>new Proxy(()=>{},{get(r,a,s){return Y(e,`${t}/${a.toString()}`,n)},apply(r,a,[s,i={}]=[{},{}]){let y=s!==void 0&&(typeof s!="object"||Array.isArray(s))?s:void 0,{$query:j,$fetch:k,$headers:w,$transform:T,getRaw:F,...m}=s??{};y??=m;let b=t.lastIndexOf("/"),S=t.slice(b+1).toUpperCase(),h=z(e,b===-1?"/":t.slice(0,b),Object.assign(i.query??{},j)),N=n.fetcher??fetch,v=n.transform?Array.isArray(n.transform)?n.transform:[n.transform]:void 0,o=T?Array.isArray(T)?T:[T]:void 0;return o&&(v?v=o.concat(v):v=o),S==="SUBSCRIBE"?new B(h.replace(/^([^]+):\/\//,h.startsWith("https://")?"wss://":"ws://")):(async E=>{let c,g={...n.$fetch?.headers,...k?.headers,...i.headers,...w};if(S!=="GET"&&S!=="HEAD"){c=Object.keys(y).length||Array.isArray(y)?y:void 0;let l=c&&(typeof c=="object"||Array.isArray(y));if(l&&Ee(c)){let $=new FormData;for(let[C,R]of Object.entries(c))if(V)$.append(C,R);else if(R instanceof File)$.append(C,await _(R));else if(R instanceof FileList)for(let W=0;W<R.length;W++)$.append(C,await _(R[W]));else if(Array.isArray(R))for(let W=0;W<R.length;W++){let q=R[W];$.append(C,q instanceof File?await _(q):q)}else $.append(C,R);c=$}else c!=null&&(g["content-type"]=l?"application/json":"text/plain",c=l?JSON.stringify(c):y)}let p=await N(h,{method:S,body:c,...n.$fetch,...i.fetch,...k,headers:g}),u;if(E.getRaw)return p;switch(p.headers.get("Content-Type")?.split(";")[0]){case"application/json":u=await p.json();break;default:u=await p.text().then(L)}let f=p.status>=300||p.status<200?new x(p.status,u):null,d={data:u,error:f,response:p,status:p.status,headers:p.headers};if(v)for(let l of v){let A=l(d);A instanceof Promise&&(A=await A),A!=null&&(d=A)}return d})({getRaw:F})}}),ee=(e,t={fetcher:fetch})=>new Proxy({},{get(n,r){return Y(e,r,t)}});var we=async e=>{switch(e.headers.get("Content-Type")?.split(";")[0]){case"application/json":return e.json();case"application/octet-stream":return e.arrayBuffer();case"multipart/form-data":{let n=await e.formData(),r={};return n.forEach((a,s)=>{r[s]=a}),r}}return e.text().then(L)},be=async(e,t)=>{let n=await we(e);return e.status>300?{data:null,status:e.status,headers:e.headers,retry:t,error:new x(e.status,n)}:{data:n,error:null,status:e.status,headers:e.headers,retry:t}},te=(e,t)=>(n,{query:r,params:a,body:s,...i}={})=>{a&&Object.entries(a).forEach(([S,h])=>{n=n.replace(`:${S}`,h)});let y=t?.fetcher||globalThis.fetch,j=r?Object.fromEntries(Object.entries(r).filter(([S,h])=>h!=null)):null,k=j?`?${new URLSearchParams(j).toString()}`:"",w=`${e}${n}${k}`,T=new Headers(i.headers||{}),F=T.get("content-type");if(!(s instanceof FormData)&&!(s instanceof URLSearchParams)&&(!F||F==="application/json"))try{s=JSON.stringify(s),F||T.set("content-type","application/json")}catch{}let m={...i,method:i.method?.toUpperCase()||"GET",headers:T,body:s},b=()=>y(w,m).then(S=>be(S,b));return b()};return oe(Se);})();
+`);for(let n of t){if(n.indexOf(":")<=0){n&&(yield W(n));continue}let r=n.split(`
+`),a={};for(let s of r){let i=s.indexOf(":");if(i>0){let u=s.slice(0,i).trim(),M=s.slice(i+1).trim();a[u]=W(M)}}yield a}}var K=(e,t,n=[],r)=>new Proxy(()=>{},{get(a,s){return K(e,t,s==="index"?n:[...n,s],r)},apply(a,s,[i,u]){if(!i||u||typeof i=="object"&&Object.keys(i).length!==1||pe.includes(n.at(-1))){let M=[...n],F=M.pop(),x="/"+M.join("/"),{fetcher:R=fetch,headers:j,onRequest:E,onResponse:A,fetch:k}=t,h=F==="get"||F==="head"||F==="subscribe";j=C(j,x,u);let N=h?i?.query:u?.query,O="";if(N){let o=(L,w)=>{O+=(O?"&":"?")+`${encodeURIComponent(L)}=${encodeURIComponent(w)}`};for(let[L,w]of Object.entries(N)){if(Array.isArray(w)){for(let c of w)o(L,c);continue}if(w!=null){if(typeof w=="object"){o(L,JSON.stringify(w));continue}o(L,`${w}`)}}}if(F==="subscribe"){let o=e.replace(/^([^]+):\/\//,e.startsWith("https://")?"wss://":e.startsWith("http://")||Z.find(L=>e.includes(L))?"ws://":"wss://")+x+O;return new P(o)}return(async()=>{let o={method:F?.toUpperCase(),body:i,...k,headers:j};o.headers={...j,...C(h?i?.headers:u?.headers,x,o)};let L=h&&typeof i=="object"?i.fetch:u?.fetch;if(o={...o,...L},h&&delete o.body,E){Array.isArray(E)||(E=[E]);for(let l of E){let d=await l(x,o);typeof d=="object"&&(o={...o,...d,headers:{...o.headers,...C(d.headers,x,o)}})}}if(h&&delete o.body,he(i)){let l=new FormData,d=f=>typeof f=="string"||q(f)?!1:typeof f=="object"&&f!==null,m=async f=>f instanceof File?await V(f):d(f)?JSON.stringify(f):f;for(let[f,y]of Object.entries(o.body)){if(Array.isArray(y)){if(y.some(S=>typeof S=="object"&&S!==null&&!q(S)))l.append(f,JSON.stringify(y));else for(let S=0;S<y.length;S++){let v=y[S],$=await m(v);l.append(f,$)}continue}if(H){if(Array.isArray(y))for(let b of y)l.append(f,await m(b));else l.append(f,await m(y));continue}if(y instanceof File){l.append(f,await V(y));continue}if(y instanceof FileList){for(let b=0;b<y.length;b++)l.append(f,await V(y[b]));continue}l.append(f,await m(y))}o.body=l}else typeof i=="object"?(o.headers["content-type"]="application/json",o.body=JSON.stringify(i)):i!=null&&(o.headers["content-type"]="text/plain");if(h&&delete o.body,E){Array.isArray(E)||(E=[E]);for(let l of E){let d=await l(x,o);typeof d=="object"&&(o={...o,...d,headers:{...o.headers,...C(d.headers,x,o)}})}}u?.headers?.["content-type"]&&(o.headers["content-type"]=u?.headers["content-type"]);let w=e+x+O,c=await(r?.handle(new Request(w,o))??R(w,o)),g=null,p=null;if(A){Array.isArray(A)||(A=[A]);for(let l of A)try{let d=await l(c.clone());if(d!=null){g=d;break}}catch(d){d instanceof T?p=d:p=new T(422,d);break}}if(g!==null)return{data:g,error:p,response:c,status:c.status,headers:c.headers};switch(c.headers.get("Content-Type")?.split(";")[0]){case"text/event-stream":g=ge(c);break;case"application/json":g=JSON.parse(await c.text(),(d,m)=>{if(typeof m!="string")return m;let f=D(m);return f||m});break;case"application/octet-stream":g=await c.arrayBuffer();break;case"multipart/form-data":let l=await c.formData();g={},l.forEach((d,m)=>{g[m]=d});break;default:g=await c.text().then(W)}return(c.status>=300||c.status<200)&&(p=new T(c.status,g),g=null),{data:g,error:p,response:c,status:c.status,headers:c.headers}})()}return typeof i=="object"?K(e,t,[...n,Object.values(i)[0]],r):K(e,t,n)}}),Q=(e,t={})=>typeof e=="string"?(t.keepDomain||(e.includes("://")||(e=(Z.find(n=>e.includes(n))?"http://":"https://")+e),e.endsWith("/")&&(e=e.slice(0,-1))),K(e,t)):(typeof window<"u"&&console.warn("Elysia instance server found on client side, this is not recommended for security reason. Use generic type instead."),K("http://e.ly",t,[],e));var z=(e,t,n)=>{if(e.endsWith("/")||(e+="/"),t==="index"&&(t=""),!n||!Object.keys(n).length)return`${e}${t}`;let r="";for(let[a,s]of Object.entries(n))r+=`${a}=${s}&`;return`${e}${t}?${r.slice(0,-1)}`};var G=typeof FileList>"u",X=e=>G?e instanceof Blob:e instanceof FileList||e instanceof File,Ee=e=>{if(!e)return!1;for(let t in e){if(X(e[t]))return!0;if(Array.isArray(e[t])&&e[t].find(n=>X(n)))return!0}return!1},_=e=>G?e:new Promise(t=>{let n=new FileReader;n.onload=()=>{let r=new File([n.result],e.name,{lastModified:e.lastModified,type:e.type});t(r)},n.readAsArrayBuffer(e)}),B=class{ws;url;constructor(t){this.ws=new WebSocket(t),this.url=t}send(t){return Array.isArray(t)?(t.forEach(n=>this.send(n)),this):(this.ws.send(typeof t=="object"?JSON.stringify(t):t.toString()),this)}on(t,n,r){return this.addEventListener(t,n,r)}off(t,n,r){return this.ws.removeEventListener(t,n,r),this}subscribe(t,n){return this.addEventListener("message",t,n)}addEventListener(t,n,r){return this.ws.addEventListener(t,a=>{if(t==="message"){let s=I(a);n({...a,data:s})}else n(a)},r),this}removeEventListener(t,n,r){return this.off(t,n,r),this}close(){return this.ws.close(),this}},Y=(e,t="",n)=>new Proxy(()=>{},{get(r,a,s){return Y(e,`${t}/${a.toString()}`,n)},apply(r,a,[s,i={}]=[{},{}]){let u=s!==void 0&&(typeof s!="object"||Array.isArray(s))?s:void 0,{$query:M,$fetch:F,$headers:x,$transform:R,getRaw:j,...E}=s??{};u??=E;let A=t.lastIndexOf("/"),k=t.slice(A+1).toUpperCase(),h=z(e,A===-1?"/":t.slice(0,A),Object.assign(i.query??{},M)),N=n.fetcher??fetch,O=n.transform?Array.isArray(n.transform)?n.transform:[n.transform]:void 0,o=R?Array.isArray(R)?R:[R]:void 0;return o&&(O?O=o.concat(O):O=o),k==="SUBSCRIBE"?new B(h.replace(/^([^]+):\/\//,h.startsWith("https://")?"wss://":"ws://")):(async w=>{let c,g={...n.$fetch?.headers,...F?.headers,...i.headers,...x};if(k!=="GET"&&k!=="HEAD"){c=Object.keys(u).length||Array.isArray(u)?u:void 0;let f=c&&(typeof c=="object"||Array.isArray(u));if(f&&Ee(c)){let b=new FormData;for(let[S,v]of Object.entries(c))if(G)b.append(S,v);else if(v instanceof File)b.append(S,await _(v));else if(v instanceof FileList)for(let $=0;$<v.length;$++)b.append(S,await _(v[$]));else if(Array.isArray(v))for(let $=0;$<v.length;$++){let J=v[$];b.append(S,J instanceof File?await _(J):J)}else b.append(S,v);c=b}else c!=null&&(g["content-type"]=f?"application/json":"text/plain",c=f?JSON.stringify(c):u)}let p=await N(h,{method:k,body:c,...n.$fetch,...i.fetch,...F,headers:g}),l;if(w.getRaw)return p;switch(p.headers.get("Content-Type")?.split(";")[0]){case"application/json":l=await p.json();break;default:l=await p.text().then(W)}let d=p.status>=300||p.status<200?new T(p.status,l):null,m={data:l,error:d,response:p,status:p.status,headers:p.headers};if(O)for(let f of O){let y=f(m);y instanceof Promise&&(y=await y),y!=null&&(m=y)}return m})({getRaw:j})}}),ee=(e,t={fetcher:fetch})=>new Proxy({},{get(n,r){return Y(e,r,t)}});var we=async e=>{switch(e.headers.get("Content-Type")?.split(";")[0]){case"application/json":return e.json();case"application/octet-stream":return e.arrayBuffer();case"multipart/form-data":{let n=await e.formData(),r={};return n.forEach((a,s)=>{r[s]=a}),r}}return e.text().then(W)},be=async(e,t)=>{let n=await we(e);return e.status>300?{data:null,status:e.status,headers:e.headers,retry:t,error:new T(e.status,n)}:{data:n,error:null,status:e.status,headers:e.headers,retry:t}},te=(e,t)=>(n,{query:r,params:a,body:s,...i}={})=>{a&&Object.entries(a).forEach(([k,h])=>{n=n.replace(`:${k}`,h)});let u=t?.fetcher||globalThis.fetch,M=r?Object.fromEntries(Object.entries(r).filter(([k,h])=>h!=null)):null,F=M?`?${new URLSearchParams(M).toString()}`:"",x=`${e}${n}${F}`,R=new Headers(i.headers||{}),j=R.get("content-type");if(!(s instanceof FormData)&&!(s instanceof URLSearchParams)&&(!j||j==="application/json"))try{s=JSON.stringify(s),j||R.set("content-type","application/json")}catch{}let E={...i,method:i.method?.toUpperCase()||"GET",headers:R,body:s},A=()=>u(x,E).then(k=>be(k,A));return A()};return oe(Se);})();
diff --git a/dist/index.js b/dist/index.js
index e8ae3c7d21d3b45894df3b6397311a4ead89e4bc..0993b7bb3ee14576569f854f9619b40d9733821e 100644
--- a/dist/index.js
+++ b/dist/index.js
@@ -1,6 +1,6 @@
-"use strict";var J=Object.defineProperty;var ne=Object.getOwnPropertyDescriptor;var re=Object.getOwnPropertyNames;var se=Object.prototype.hasOwnProperty;var ae=(e,t)=>{for(var n in t)J(e,n,{get:t[n],enumerable:!0})},ie=(e,t,n,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let a of re(t))!se.call(e,a)&&a!==n&&J(e,a,{get:()=>t[a],enumerable:!(r=ne(t,a))||r.enumerable});return e};var oe=e=>ie(J({},"__esModule",{value:!0}),e);var Se={};ae(Se,{EdenFetchError:()=>x,edenFetch:()=>te,edenTreaty:()=>ee,treaty:()=>Q});module.exports=oe(Se);var x=class extends Error{constructor(n,r){super(r+"");this.status=n;this.value=r}};var ce=/(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))/,fe=/(?:Sun|Mon|Tue|Wed|Thu|Fri|Sat)\s(?:Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s\d{2}\s\d{4}\s\d{2}:\d{2}:\d{2}\sGMT(?:\+|-)\d{4}\s\([^)]+\)/,de=/^(?:(?:(?:(?:0?[1-9]|[12][0-9]|3[01])[/\s-](?:0?[1-9]|1[0-2])[/\s-](?:19|20)\d{2})|(?:(?:19|20)\d{2}[/\s-](?:0?[1-9]|1[0-2])[/\s-](?:0?[1-9]|[12][0-9]|3[01]))))(?:\s(?:1[012]|0?[1-9]):[0-5][0-9](?::[0-5][0-9])?(?:\s[AP]M)?)?$/,ye=e=>e.trim().length!==0&&!Number.isNaN(Number(e)),D=e=>{if(typeof e!="string")return null;let t=e.replace(/"/g,"");if(ce.test(t)||fe.test(t)||de.test(t)){let n=new Date(t);if(!Number.isNaN(n.getTime()))return n}return null},ue=e=>{let t=e.charCodeAt(0),n=e.charCodeAt(e.length-1);return t===123&&n===125||t===91&&n===93},le=e=>JSON.parse(e,(t,n)=>{let r=D(n);return r||n}),L=e=>{if(!e)return e;if(ye(e))return+e;if(e==="true")return!0;if(e==="false")return!1;let t=D(e);if(t)return t;if(ue(e))try{return le(e)}catch{}return e},I=e=>{let t=e.data.toString();return t==="null"?null:L(t)};var P=class{constructor(t){this.url=t;this.ws=new WebSocket(t)}ws;send(t){return Array.isArray(t)?(t.forEach(n=>this.send(n)),this):(this.ws.send(typeof t=="object"?JSON.stringify(t):t.toString()),this)}on(t,n,r){return this.addEventListener(t,n,r)}off(t,n,r){return this.ws.removeEventListener(t,n,r),this}subscribe(t,n){return this.addEventListener("message",t,n)}addEventListener(t,n,r){return this.ws.addEventListener(t,a=>{if(t==="message"){let s=I(a);n({...a,data:s})}else n(a)},r),this}removeEventListener(t,n,r){return this.off(t,n,r),this}close(){return this.ws.close(),this}};var pe=["get","post","put","delete","patch","options","head","connect","subscribe"],Z=["localhost","127.0.0.1","0.0.0.0"],H=typeof FileList>"u",G=e=>H?e instanceof Blob:e instanceof FileList||e instanceof File,he=e=>{if(!e)return!1;for(let t in e)if(G(e[t])||Array.isArray(e[t])&&e[t].find(G))return!0;return!1},U=e=>H?e:new Promise(t=>{let n=new FileReader;n.onload=()=>{let r=new File([n.result],e.name,{lastModified:e.lastModified,type:e.type});t(r)},n.readAsArrayBuffer(e)}),M=(e,t,n={},r={})=>{if(Array.isArray(e)){for(let a of e)if(!Array.isArray(a))r=M(a,t,n,r);else{let s=a[0];if(typeof s=="string")r[s.toLowerCase()]=a[1];else for(let[i,y]of s)r[i.toLowerCase()]=y}return r}if(!e)return r;switch(typeof e){case"function":if(e instanceof Headers)return M(e,t,n,r);let a=e(t,n);return a?M(a,t,n,r):r;case"object":if(e instanceof Headers)return e.forEach((s,i)=>{r[i.toLowerCase()]=s}),r;for(let[s,i]of Object.entries(e))r[s.toLowerCase()]=i;return r;default:return r}};async function*ge(e){let t=e.body;if(!t)return;let n=t.getReader(),r=new TextDecoder;try{for(;;){let{done:a,value:s}=await n.read();if(a)break;let i=typeof s=="string"?s:r.decode(s);i.includes(`
+"use strict";var U=Object.defineProperty;var ne=Object.getOwnPropertyDescriptor;var re=Object.getOwnPropertyNames;var se=Object.prototype.hasOwnProperty;var ae=(e,t)=>{for(var n in t)U(e,n,{get:t[n],enumerable:!0})},ie=(e,t,n,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let a of re(t))!se.call(e,a)&&a!==n&&U(e,a,{get:()=>t[a],enumerable:!(r=ne(t,a))||r.enumerable});return e};var oe=e=>ie(U({},"__esModule",{value:!0}),e);var Se={};ae(Se,{EdenFetchError:()=>T,edenFetch:()=>te,edenTreaty:()=>ee,treaty:()=>Q});module.exports=oe(Se);var T=class extends Error{constructor(n,r){super(r+"");this.status=n;this.value=r}};var ce=/(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))/,fe=/(?:Sun|Mon|Tue|Wed|Thu|Fri|Sat)\s(?:Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s\d{2}\s\d{4}\s\d{2}:\d{2}:\d{2}\sGMT(?:\+|-)\d{4}\s\([^)]+\)/,de=/^(?:(?:(?:(?:0?[1-9]|[12][0-9]|3[01])[/\s-](?:0?[1-9]|1[0-2])[/\s-](?:19|20)\d{2})|(?:(?:19|20)\d{2}[/\s-](?:0?[1-9]|1[0-2])[/\s-](?:0?[1-9]|[12][0-9]|3[01]))))(?:\s(?:1[012]|0?[1-9]):[0-5][0-9](?::[0-5][0-9])?(?:\s[AP]M)?)?$/,ye=e=>e.trim().length!==0&&!Number.isNaN(Number(e)),D=e=>{if(typeof e!="string")return null;let t=e.replace(/"/g,"");if(ce.test(t)||fe.test(t)||de.test(t)){let n=new Date(t);if(!Number.isNaN(n.getTime()))return n}return null},ue=e=>{let t=e.charCodeAt(0),n=e.charCodeAt(e.length-1);return t===123&&n===125||t===91&&n===93},le=e=>JSON.parse(e,(t,n)=>{let r=D(n);return r||n}),W=e=>{if(!e)return e;if(ye(e))return+e;if(e==="true")return!0;if(e==="false")return!1;let t=D(e);if(t)return t;if(ue(e))try{return le(e)}catch{}return e},I=e=>{let t=e.data.toString();return t==="null"?null:W(t)};var P=class{constructor(t){this.url=t;this.ws=new WebSocket(t)}ws;send(t){return Array.isArray(t)?(t.forEach(n=>this.send(n)),this):(this.ws.send(typeof t=="object"?JSON.stringify(t):t.toString()),this)}on(t,n,r){return this.addEventListener(t,n,r)}off(t,n,r){return this.ws.removeEventListener(t,n,r),this}subscribe(t,n){return this.addEventListener("message",t,n)}addEventListener(t,n,r){return this.ws.addEventListener(t,a=>{if(t==="message"){let s=I(a);n({...a,data:s})}else n(a)},r),this}removeEventListener(t,n,r){return this.off(t,n,r),this}close(){return this.ws.close(),this}};var pe=["get","post","put","delete","patch","options","head","connect","subscribe"],Z=["localhost","127.0.0.1","0.0.0.0"],H=typeof FileList>"u",q=e=>H?e instanceof Blob:e instanceof FileList||e instanceof File,he=e=>{if(!e)return!1;for(let t in e)if(q(e[t])||Array.isArray(e[t])&&e[t].find(q))return!0;return!1},V=e=>H?e:new Promise(t=>{let n=new FileReader;n.onload=()=>{let r=new File([n.result],e.name,{lastModified:e.lastModified,type:e.type});t(r)},n.readAsArrayBuffer(e)}),C=(e,t,n={},r={})=>{if(Array.isArray(e)){for(let a of e)if(!Array.isArray(a))r=C(a,t,n,r);else{let s=a[0];if(typeof s=="string")r[s.toLowerCase()]=a[1];else for(let[i,u]of s)r[i.toLowerCase()]=u}return r}if(!e)return r;switch(typeof e){case"function":if(e instanceof Headers)return C(e,t,n,r);let a=e(t,n);return a?C(a,t,n,r):r;case"object":if(e instanceof Headers)return e.forEach((s,i)=>{r[i.toLowerCase()]=s}),r;for(let[s,i]of Object.entries(e))r[s.toLowerCase()]=i;return r;default:return r}};async function*ge(e){let t=e.body;if(!t)return;let n=t.getReader(),r=new TextDecoder;try{for(;;){let{done:a,value:s}=await n.read();if(a)break;let i=typeof s=="string"?s:r.decode(s);i.includes(`
 
-`)?yield*me(i):yield L(i)}}finally{n.releaseLock()}}function*me(e){let t=e.split(`
+`)?yield*me(i):yield W(i)}}finally{n.releaseLock()}}function*me(e){let t=e.split(`
 
-`);for(let n of t){if(n.indexOf(":")<=0){n&&(yield L(n));continue}let r=n.split(`
-`),a={};for(let s of r){let i=s.indexOf(":");if(i>0){let y=s.slice(0,i).trim(),j=s.slice(i+1).trim();a[y]=L(j)}}yield a}}var K=(e,t,n=[],r)=>new Proxy(()=>{},{get(a,s){return K(e,t,s==="index"?n:[...n,s],r)},apply(a,s,[i,y]){if(!i||y||typeof i=="object"&&Object.keys(i).length!==1||pe.includes(n.at(-1))){let j=[...n],k=j.pop(),w="/"+j.join("/"),{fetcher:T=fetch,headers:F,onRequest:m,onResponse:b,fetch:S}=t,h=k==="get"||k==="head"||k==="subscribe";F=M(F,w,y);let N=h?i?.query:y?.query,v="";if(N){let o=(O,E)=>{v+=(v?"&":"?")+`${encodeURIComponent(O)}=${encodeURIComponent(E)}`};for(let[O,E]of Object.entries(N)){if(Array.isArray(E)){for(let c of E)o(O,c);continue}if(E!=null){if(typeof E=="object"){o(O,JSON.stringify(E));continue}o(O,`${E}`)}}}if(k==="subscribe"){let o=e.replace(/^([^]+):\/\//,e.startsWith("https://")?"wss://":e.startsWith("http://")||Z.find(O=>e.includes(O))?"ws://":"wss://")+w+v;return new P(o)}return(async()=>{let o={method:k?.toUpperCase(),body:i,...S,headers:F};o.headers={...F,...M(h?i?.headers:y?.headers,w,o)};let O=h&&typeof i=="object"?i.fetch:y?.fetch;if(o={...o,...O},h&&delete o.body,m){Array.isArray(m)||(m=[m]);for(let u of m){let f=await u(w,o);typeof f=="object"&&(o={...o,...f,headers:{...o.headers,...M(f.headers,w,o)}})}}if(h&&delete o.body,he(i)){let u=new FormData;for(let[f,d]of Object.entries(o.body)){if(Array.isArray(d)){for(let l=0;l<d.length;l++){let A=d[l];u.append(f,A instanceof File?await U(A):A)}continue}if(H){if(Array.isArray(d))for(let l of d)u.append(f,l);else u.append(f,d);continue}if(d instanceof File){u.append(f,await U(d));continue}if(d instanceof FileList){for(let l=0;l<d.length;l++)u.append(f,await U(d[l]));continue}u.append(f,d)}o.body=u}else typeof i=="object"?(o.headers["content-type"]="application/json",o.body=JSON.stringify(i)):i!=null&&(o.headers["content-type"]="text/plain");if(h&&delete o.body,m){Array.isArray(m)||(m=[m]);for(let u of m){let f=await u(w,o);typeof f=="object"&&(o={...o,...f,headers:{...o.headers,...M(f.headers,w,o)}})}}y?.headers?.["content-type"]&&(o.headers["content-type"]=y?.headers["content-type"]);let E=e+w+v,c=await(r?.handle(new Request(E,o))??T(E,o)),g=null,p=null;if(b){Array.isArray(b)||(b=[b]);for(let u of b)try{let f=await u(c.clone());if(f!=null){g=f;break}}catch(f){f instanceof x?p=f:p=new x(422,f);break}}if(g!==null)return{data:g,error:p,response:c,status:c.status,headers:c.headers};switch(c.headers.get("Content-Type")?.split(";")[0]){case"text/event-stream":g=ge(c);break;case"application/json":g=JSON.parse(await c.text(),(f,d)=>{if(typeof d!="string")return d;let l=D(d);return l||d});break;case"application/octet-stream":g=await c.arrayBuffer();break;case"multipart/form-data":let u=await c.formData();g={},u.forEach((f,d)=>{g[d]=f});break;default:g=await c.text().then(L)}return(c.status>=300||c.status<200)&&(p=new x(c.status,g),g=null),{data:g,error:p,response:c,status:c.status,headers:c.headers}})()}return typeof i=="object"?K(e,t,[...n,Object.values(i)[0]],r):K(e,t,n)}}),Q=(e,t={})=>typeof e=="string"?(t.keepDomain||(e.includes("://")||(e=(Z.find(n=>e.includes(n))?"http://":"https://")+e),e.endsWith("/")&&(e=e.slice(0,-1))),K(e,t)):(typeof window<"u"&&console.warn("Elysia instance server found on client side, this is not recommended for security reason. Use generic type instead."),K("http://e.ly",t,[],e));var z=(e,t,n)=>{if(e.endsWith("/")||(e+="/"),t==="index"&&(t=""),!n||!Object.keys(n).length)return`${e}${t}`;let r="";for(let[a,s]of Object.entries(n))r+=`${a}=${s}&`;return`${e}${t}?${r.slice(0,-1)}`};var V=typeof FileList>"u",X=e=>V?e instanceof Blob:e instanceof FileList||e instanceof File,Ee=e=>{if(!e)return!1;for(let t in e){if(X(e[t]))return!0;if(Array.isArray(e[t])&&e[t].find(n=>X(n)))return!0}return!1},_=e=>V?e:new Promise(t=>{let n=new FileReader;n.onload=()=>{let r=new File([n.result],e.name,{lastModified:e.lastModified,type:e.type});t(r)},n.readAsArrayBuffer(e)}),B=class{ws;url;constructor(t){this.ws=new WebSocket(t),this.url=t}send(t){return Array.isArray(t)?(t.forEach(n=>this.send(n)),this):(this.ws.send(typeof t=="object"?JSON.stringify(t):t.toString()),this)}on(t,n,r){return this.addEventListener(t,n,r)}off(t,n,r){return this.ws.removeEventListener(t,n,r),this}subscribe(t,n){return this.addEventListener("message",t,n)}addEventListener(t,n,r){return this.ws.addEventListener(t,a=>{if(t==="message"){let s=I(a);n({...a,data:s})}else n(a)},r),this}removeEventListener(t,n,r){return this.off(t,n,r),this}close(){return this.ws.close(),this}},Y=(e,t="",n)=>new Proxy(()=>{},{get(r,a,s){return Y(e,`${t}/${a.toString()}`,n)},apply(r,a,[s,i={}]=[{},{}]){let y=s!==void 0&&(typeof s!="object"||Array.isArray(s))?s:void 0,{$query:j,$fetch:k,$headers:w,$transform:T,getRaw:F,...m}=s??{};y??=m;let b=t.lastIndexOf("/"),S=t.slice(b+1).toUpperCase(),h=z(e,b===-1?"/":t.slice(0,b),Object.assign(i.query??{},j)),N=n.fetcher??fetch,v=n.transform?Array.isArray(n.transform)?n.transform:[n.transform]:void 0,o=T?Array.isArray(T)?T:[T]:void 0;return o&&(v?v=o.concat(v):v=o),S==="SUBSCRIBE"?new B(h.replace(/^([^]+):\/\//,h.startsWith("https://")?"wss://":"ws://")):(async E=>{let c,g={...n.$fetch?.headers,...k?.headers,...i.headers,...w};if(S!=="GET"&&S!=="HEAD"){c=Object.keys(y).length||Array.isArray(y)?y:void 0;let l=c&&(typeof c=="object"||Array.isArray(y));if(l&&Ee(c)){let $=new FormData;for(let[C,R]of Object.entries(c))if(V)$.append(C,R);else if(R instanceof File)$.append(C,await _(R));else if(R instanceof FileList)for(let W=0;W<R.length;W++)$.append(C,await _(R[W]));else if(Array.isArray(R))for(let W=0;W<R.length;W++){let q=R[W];$.append(C,q instanceof File?await _(q):q)}else $.append(C,R);c=$}else c!=null&&(g["content-type"]=l?"application/json":"text/plain",c=l?JSON.stringify(c):y)}let p=await N(h,{method:S,body:c,...n.$fetch,...i.fetch,...k,headers:g}),u;if(E.getRaw)return p;switch(p.headers.get("Content-Type")?.split(";")[0]){case"application/json":u=await p.json();break;default:u=await p.text().then(L)}let f=p.status>=300||p.status<200?new x(p.status,u):null,d={data:u,error:f,response:p,status:p.status,headers:p.headers};if(v)for(let l of v){let A=l(d);A instanceof Promise&&(A=await A),A!=null&&(d=A)}return d})({getRaw:F})}}),ee=(e,t={fetcher:fetch})=>new Proxy({},{get(n,r){return Y(e,r,t)}});var we=async e=>{switch(e.headers.get("Content-Type")?.split(";")[0]){case"application/json":return e.json();case"application/octet-stream":return e.arrayBuffer();case"multipart/form-data":{let n=await e.formData(),r={};return n.forEach((a,s)=>{r[s]=a}),r}}return e.text().then(L)},be=async(e,t)=>{let n=await we(e);return e.status>300?{data:null,status:e.status,headers:e.headers,retry:t,error:new x(e.status,n)}:{data:n,error:null,status:e.status,headers:e.headers,retry:t}},te=(e,t)=>(n,{query:r,params:a,body:s,...i}={})=>{a&&Object.entries(a).forEach(([S,h])=>{n=n.replace(`:${S}`,h)});let y=t?.fetcher||globalThis.fetch,j=r?Object.fromEntries(Object.entries(r).filter(([S,h])=>h!=null)):null,k=j?`?${new URLSearchParams(j).toString()}`:"",w=`${e}${n}${k}`,T=new Headers(i.headers||{}),F=T.get("content-type");if(!(s instanceof FormData)&&!(s instanceof URLSearchParams)&&(!F||F==="application/json"))try{s=JSON.stringify(s),F||T.set("content-type","application/json")}catch{}let m={...i,method:i.method?.toUpperCase()||"GET",headers:T,body:s},b=()=>y(w,m).then(S=>be(S,b));return b()};0&&(module.exports={EdenFetchError,edenFetch,edenTreaty,treaty});
+`);for(let n of t){if(n.indexOf(":")<=0){n&&(yield W(n));continue}let r=n.split(`
+`),a={};for(let s of r){let i=s.indexOf(":");if(i>0){let u=s.slice(0,i).trim(),M=s.slice(i+1).trim();a[u]=W(M)}}yield a}}var K=(e,t,n=[],r)=>new Proxy(()=>{},{get(a,s){return K(e,t,s==="index"?n:[...n,s],r)},apply(a,s,[i,u]){if(!i||u||typeof i=="object"&&Object.keys(i).length!==1||pe.includes(n.at(-1))){let M=[...n],F=M.pop(),x="/"+M.join("/"),{fetcher:R=fetch,headers:j,onRequest:E,onResponse:A,fetch:k}=t,h=F==="get"||F==="head"||F==="subscribe";j=C(j,x,u);let N=h?i?.query:u?.query,O="";if(N){let o=(L,w)=>{O+=(O?"&":"?")+`${encodeURIComponent(L)}=${encodeURIComponent(w)}`};for(let[L,w]of Object.entries(N)){if(Array.isArray(w)){for(let c of w)o(L,c);continue}if(w!=null){if(typeof w=="object"){o(L,JSON.stringify(w));continue}o(L,`${w}`)}}}if(F==="subscribe"){let o=e.replace(/^([^]+):\/\//,e.startsWith("https://")?"wss://":e.startsWith("http://")||Z.find(L=>e.includes(L))?"ws://":"wss://")+x+O;return new P(o)}return(async()=>{let o={method:F?.toUpperCase(),body:i,...k,headers:j};o.headers={...j,...C(h?i?.headers:u?.headers,x,o)};let L=h&&typeof i=="object"?i.fetch:u?.fetch;if(o={...o,...L},h&&delete o.body,E){Array.isArray(E)||(E=[E]);for(let l of E){let d=await l(x,o);typeof d=="object"&&(o={...o,...d,headers:{...o.headers,...C(d.headers,x,o)}})}}if(h&&delete o.body,he(i)){let l=new FormData,d=f=>typeof f=="string"||q(f)?!1:typeof f=="object"&&f!==null,m=async f=>f instanceof File?await V(f):d(f)?JSON.stringify(f):f;for(let[f,y]of Object.entries(o.body)){if(Array.isArray(y)){if(y.some(S=>typeof S=="object"&&S!==null&&!q(S)))l.append(f,JSON.stringify(y));else for(let S=0;S<y.length;S++){let v=y[S],$=await m(v);l.append(f,$)}continue}if(H){if(Array.isArray(y))for(let b of y)l.append(f,await m(b));else l.append(f,await m(y));continue}if(y instanceof File){l.append(f,await V(y));continue}if(y instanceof FileList){for(let b=0;b<y.length;b++)l.append(f,await V(y[b]));continue}l.append(f,await m(y))}o.body=l}else typeof i=="object"?(o.headers["content-type"]="application/json",o.body=JSON.stringify(i)):i!=null&&(o.headers["content-type"]="text/plain");if(h&&delete o.body,E){Array.isArray(E)||(E=[E]);for(let l of E){let d=await l(x,o);typeof d=="object"&&(o={...o,...d,headers:{...o.headers,...C(d.headers,x,o)}})}}u?.headers?.["content-type"]&&(o.headers["content-type"]=u?.headers["content-type"]);let w=e+x+O,c=await(r?.handle(new Request(w,o))??R(w,o)),g=null,p=null;if(A){Array.isArray(A)||(A=[A]);for(let l of A)try{let d=await l(c.clone());if(d!=null){g=d;break}}catch(d){d instanceof T?p=d:p=new T(422,d);break}}if(g!==null)return{data:g,error:p,response:c,status:c.status,headers:c.headers};switch(c.headers.get("Content-Type")?.split(";")[0]){case"text/event-stream":g=ge(c);break;case"application/json":g=JSON.parse(await c.text(),(d,m)=>{if(typeof m!="string")return m;let f=D(m);return f||m});break;case"application/octet-stream":g=await c.arrayBuffer();break;case"multipart/form-data":let l=await c.formData();g={},l.forEach((d,m)=>{g[m]=d});break;default:g=await c.text().then(W)}return(c.status>=300||c.status<200)&&(p=new T(c.status,g),g=null),{data:g,error:p,response:c,status:c.status,headers:c.headers}})()}return typeof i=="object"?K(e,t,[...n,Object.values(i)[0]],r):K(e,t,n)}}),Q=(e,t={})=>typeof e=="string"?(t.keepDomain||(e.includes("://")||(e=(Z.find(n=>e.includes(n))?"http://":"https://")+e),e.endsWith("/")&&(e=e.slice(0,-1))),K(e,t)):(typeof window<"u"&&console.warn("Elysia instance server found on client side, this is not recommended for security reason. Use generic type instead."),K("http://e.ly",t,[],e));var z=(e,t,n)=>{if(e.endsWith("/")||(e+="/"),t==="index"&&(t=""),!n||!Object.keys(n).length)return`${e}${t}`;let r="";for(let[a,s]of Object.entries(n))r+=`${a}=${s}&`;return`${e}${t}?${r.slice(0,-1)}`};var G=typeof FileList>"u",X=e=>G?e instanceof Blob:e instanceof FileList||e instanceof File,Ee=e=>{if(!e)return!1;for(let t in e){if(X(e[t]))return!0;if(Array.isArray(e[t])&&e[t].find(n=>X(n)))return!0}return!1},_=e=>G?e:new Promise(t=>{let n=new FileReader;n.onload=()=>{let r=new File([n.result],e.name,{lastModified:e.lastModified,type:e.type});t(r)},n.readAsArrayBuffer(e)}),B=class{ws;url;constructor(t){this.ws=new WebSocket(t),this.url=t}send(t){return Array.isArray(t)?(t.forEach(n=>this.send(n)),this):(this.ws.send(typeof t=="object"?JSON.stringify(t):t.toString()),this)}on(t,n,r){return this.addEventListener(t,n,r)}off(t,n,r){return this.ws.removeEventListener(t,n,r),this}subscribe(t,n){return this.addEventListener("message",t,n)}addEventListener(t,n,r){return this.ws.addEventListener(t,a=>{if(t==="message"){let s=I(a);n({...a,data:s})}else n(a)},r),this}removeEventListener(t,n,r){return this.off(t,n,r),this}close(){return this.ws.close(),this}},Y=(e,t="",n)=>new Proxy(()=>{},{get(r,a,s){return Y(e,`${t}/${a.toString()}`,n)},apply(r,a,[s,i={}]=[{},{}]){let u=s!==void 0&&(typeof s!="object"||Array.isArray(s))?s:void 0,{$query:M,$fetch:F,$headers:x,$transform:R,getRaw:j,...E}=s??{};u??=E;let A=t.lastIndexOf("/"),k=t.slice(A+1).toUpperCase(),h=z(e,A===-1?"/":t.slice(0,A),Object.assign(i.query??{},M)),N=n.fetcher??fetch,O=n.transform?Array.isArray(n.transform)?n.transform:[n.transform]:void 0,o=R?Array.isArray(R)?R:[R]:void 0;return o&&(O?O=o.concat(O):O=o),k==="SUBSCRIBE"?new B(h.replace(/^([^]+):\/\//,h.startsWith("https://")?"wss://":"ws://")):(async w=>{let c,g={...n.$fetch?.headers,...F?.headers,...i.headers,...x};if(k!=="GET"&&k!=="HEAD"){c=Object.keys(u).length||Array.isArray(u)?u:void 0;let f=c&&(typeof c=="object"||Array.isArray(u));if(f&&Ee(c)){let b=new FormData;for(let[S,v]of Object.entries(c))if(G)b.append(S,v);else if(v instanceof File)b.append(S,await _(v));else if(v instanceof FileList)for(let $=0;$<v.length;$++)b.append(S,await _(v[$]));else if(Array.isArray(v))for(let $=0;$<v.length;$++){let J=v[$];b.append(S,J instanceof File?await _(J):J)}else b.append(S,v);c=b}else c!=null&&(g["content-type"]=f?"application/json":"text/plain",c=f?JSON.stringify(c):u)}let p=await N(h,{method:k,body:c,...n.$fetch,...i.fetch,...F,headers:g}),l;if(w.getRaw)return p;switch(p.headers.get("Content-Type")?.split(";")[0]){case"application/json":l=await p.json();break;default:l=await p.text().then(W)}let d=p.status>=300||p.status<200?new T(p.status,l):null,m={data:l,error:d,response:p,status:p.status,headers:p.headers};if(O)for(let f of O){let y=f(m);y instanceof Promise&&(y=await y),y!=null&&(m=y)}return m})({getRaw:j})}}),ee=(e,t={fetcher:fetch})=>new Proxy({},{get(n,r){return Y(e,r,t)}});var we=async e=>{switch(e.headers.get("Content-Type")?.split(";")[0]){case"application/json":return e.json();case"application/octet-stream":return e.arrayBuffer();case"multipart/form-data":{let n=await e.formData(),r={};return n.forEach((a,s)=>{r[s]=a}),r}}return e.text().then(W)},be=async(e,t)=>{let n=await we(e);return e.status>300?{data:null,status:e.status,headers:e.headers,retry:t,error:new T(e.status,n)}:{data:n,error:null,status:e.status,headers:e.headers,retry:t}},te=(e,t)=>(n,{query:r,params:a,body:s,...i}={})=>{a&&Object.entries(a).forEach(([k,h])=>{n=n.replace(`:${k}`,h)});let u=t?.fetcher||globalThis.fetch,M=r?Object.fromEntries(Object.entries(r).filter(([k,h])=>h!=null)):null,F=M?`?${new URLSearchParams(M).toString()}`:"",x=`${e}${n}${F}`,R=new Headers(i.headers||{}),j=R.get("content-type");if(!(s instanceof FormData)&&!(s instanceof URLSearchParams)&&(!j||j==="application/json"))try{s=JSON.stringify(s),j||R.set("content-type","application/json")}catch{}let E={...i,method:i.method?.toUpperCase()||"GET",headers:R,body:s},A=()=>u(x,E).then(k=>be(k,A));return A()};0&&(module.exports={EdenFetchError,edenFetch,edenTreaty,treaty});
diff --git a/dist/index.mjs b/dist/index.mjs
index b766a56166cf39498466b81c547b30a62deff5ab..bdb54d083f6a7bbee3edee064869f4429bf882d7 100644
--- a/dist/index.mjs
+++ b/dist/index.mjs
@@ -1 +1 @@
-import{b as t}from"./chunk-EF6Z4LSD.mjs";import{b as r}from"./chunk-LJDYVDXQ.mjs";import{a as o}from"./chunk-4RPCKTWO.mjs";import{a as e}from"./chunk-QSLHAOSM.mjs";export{e as EdenFetchError,o as edenFetch,t as edenTreaty,r as treaty};
+import{b as t}from"./chunk-EF6Z4LSD.mjs";import{b as r}from"./chunk-YANFU6C4.mjs";import{a as o}from"./chunk-4RPCKTWO.mjs";import{a as e}from"./chunk-QSLHAOSM.mjs";export{e as EdenFetchError,o as edenFetch,t as edenTreaty,r as treaty};
diff --git a/dist/treaty2/types.d.ts b/dist/treaty2/types.d.ts
index b4b34d982b2bc3c6b114ba80250591df39d8d32a..729cb1c396d9e83598ad62a2fb5659357cc572bf 100644
--- a/dist/treaty2/types.d.ts
+++ b/dist/treaty2/types.d.ts
@@ -1,6 +1,7 @@
 import type { Elysia, ELYSIA_FORM_DATA } from 'elysia';
 import { EdenWS } from './ws';
 import type { IsNever, MaybeEmptyObject, Not, Prettify } from '../types';
+import { BunFile } from 'bun';
 type And<A extends boolean, B extends boolean> = A extends true ? B extends true ? true : false : false;
 type ReplaceGeneratorWithAsyncGenerator<in out RecordType extends Record<string, unknown>> = {
     [K in keyof RecordType]: IsNever<RecordType[K]> extends true ? RecordType[K] : RecordType[K] extends Generator<infer A, infer B, infer C> ? void extends B ? AsyncGenerator<A, B, C> : And<IsNever<A>, void extends B ? false : true> extends true ? B : AsyncGenerator<A, B, C> | B : RecordType[K] extends AsyncGenerator<infer A, infer B, infer C> ? And<Not<IsNever<A>>, void extends B ? true : false> extends true ? AsyncGenerator<A, B, C> : And<IsNever<A>, void extends B ? false : true> extends true ? B : AsyncGenerator<A, B, C> | B : RecordType[K] extends ReadableStream<infer A> ? AsyncGenerator<A, void, unknown> : RecordType[K];
@@ -9,6 +10,10 @@ type Enumerate<N extends number, Acc extends number[] = []> = Acc['length'] exte
 type IntegerRange<F extends number, T extends number> = Exclude<Enumerate<T>, Enumerate<F>>;
 type SuccessCodeRange = IntegerRange<200, 300>;
 type MaybeArray<T> = T | T[];
+type MaybeArrayFile<T> = T extends (File | BunFile)[] ? T | File | BunFile : T;
+type RelaxFileArrays<T> = T extends Record<string, unknown> ? {
+    [K in keyof T]: MaybeArrayFile<T[K]>;
+} : T;
 export declare namespace Treaty {
     interface TreatyParam {
         fetch?: RequestInit;
@@ -23,7 +28,7 @@ export declare namespace Treaty {
             params: any;
             query: infer Query;
             response: infer Res extends Record<number, unknown>;
-        } ? MaybeEmptyObject<Headers, 'headers'> & MaybeEmptyObject<Query, 'query'> extends infer Param ? {} extends Param ? undefined extends Body ? K extends 'get' | 'head' ? (options?: Prettify<Param & TreatyParam>) => Promise<TreatyResponse<ReplaceGeneratorWithAsyncGenerator<Res>>> : (body?: Body, options?: Prettify<Param & TreatyParam>) => Promise<TreatyResponse<ReplaceGeneratorWithAsyncGenerator<Res>>> : K extends 'get' | 'head' ? (options?: Prettify<Param & TreatyParam>) => Promise<TreatyResponse<ReplaceGeneratorWithAsyncGenerator<Res>>> : {} extends Body ? (body?: Body, options?: Prettify<Param & TreatyParam>) => Promise<TreatyResponse<ReplaceGeneratorWithAsyncGenerator<Res>>> : (body: Body, options?: Prettify<Param & TreatyParam>) => Promise<TreatyResponse<ReplaceGeneratorWithAsyncGenerator<Res>>> : K extends 'get' | 'head' ? (options: Prettify<Param & TreatyParam>) => Promise<TreatyResponse<ReplaceGeneratorWithAsyncGenerator<Res>>> : (body: Body, options: Prettify<Param & TreatyParam>) => Promise<TreatyResponse<ReplaceGeneratorWithAsyncGenerator<Res>>> : never : CreateParams<Route[K]>;
+        } ? MaybeEmptyObject<Headers, 'headers'> & MaybeEmptyObject<Query, 'query'> extends infer Param ? {} extends Param ? undefined extends Body ? K extends 'get' | 'head' ? (options?: Prettify<Param & TreatyParam>) => Promise<TreatyResponse<ReplaceGeneratorWithAsyncGenerator<Res>>> : (body?: RelaxFileArrays<Body>, options?: Prettify<Param & TreatyParam>) => Promise<TreatyResponse<ReplaceGeneratorWithAsyncGenerator<Res>>> : K extends 'get' | 'head' ? (options?: Prettify<Param & TreatyParam>) => Promise<TreatyResponse<ReplaceGeneratorWithAsyncGenerator<Res>>> : {} extends Body ? (body?: RelaxFileArrays<Body>, options?: Prettify<Param & TreatyParam>) => Promise<TreatyResponse<ReplaceGeneratorWithAsyncGenerator<Res>>> : (body: RelaxFileArrays<Body>, options?: Prettify<Param & TreatyParam>) => Promise<TreatyResponse<ReplaceGeneratorWithAsyncGenerator<Res>>> : K extends 'get' | 'head' ? (options: Prettify<Param & TreatyParam>) => Promise<TreatyResponse<ReplaceGeneratorWithAsyncGenerator<Res>>> : (body: RelaxFileArrays<Body>, options: Prettify<Param & TreatyParam>) => Promise<TreatyResponse<ReplaceGeneratorWithAsyncGenerator<Res>>> : never : CreateParams<Route[K]>;
     };
     type CreateParams<Route extends Record<string, any>> = Extract<keyof Route, `:${string}`> extends infer Path extends string ? IsNever<Path> extends true ? Prettify<Sign<Route>> : // ! DO NOT USE PRETTIFY ON THIS LINE, OTHERWISE FUNCTION CALLING WILL BE OMITTED
     (((params: {
diff --git a/dist/treaty2.d.mts b/dist/treaty2.d.mts
index 9a6f9f7020b655b682494ddd96c2827a46d2dbb3..0a949e668781bbede34513bbcbeb83a52448daaf 100644
--- a/dist/treaty2.d.mts
+++ b/dist/treaty2.d.mts
@@ -1,5 +1,6 @@
 import { InputSchema, Elysia, ELYSIA_FORM_DATA } from 'elysia';
 import { P as Prettify, b as MaybeEmptyObject, a as IsNever, N as Not } from './types-BdHMTa_C.mjs';
+import { BunFile } from 'bun';
 
 declare class EdenWS<in out Schema extends InputSchema<any> = {}> {
     url: string;
@@ -22,6 +23,10 @@ type Enumerate<N extends number, Acc extends number[] = []> = Acc['length'] exte
 type IntegerRange<F extends number, T extends number> = Exclude<Enumerate<T>, Enumerate<F>>;
 type SuccessCodeRange = IntegerRange<200, 300>;
 type MaybeArray<T> = T | T[];
+type MaybeArrayFile<T> = T extends (File | BunFile)[] ? T | File | BunFile : T;
+type RelaxFileArrays<T> = T extends Record<string, unknown> ? {
+    [K in keyof T]: MaybeArrayFile<T[K]>;
+} : T;
 declare namespace Treaty {
     interface TreatyParam {
         fetch?: RequestInit;
@@ -36,7 +41,7 @@ declare namespace Treaty {
             params: any;
             query: infer Query;
             response: infer Res extends Record<number, unknown>;
-        } ? MaybeEmptyObject<Headers, 'headers'> & MaybeEmptyObject<Query, 'query'> extends infer Param ? {} extends Param ? undefined extends Body ? K extends 'get' | 'head' ? (options?: Prettify<Param & TreatyParam>) => Promise<TreatyResponse<ReplaceGeneratorWithAsyncGenerator<Res>>> : (body?: Body, options?: Prettify<Param & TreatyParam>) => Promise<TreatyResponse<ReplaceGeneratorWithAsyncGenerator<Res>>> : K extends 'get' | 'head' ? (options?: Prettify<Param & TreatyParam>) => Promise<TreatyResponse<ReplaceGeneratorWithAsyncGenerator<Res>>> : {} extends Body ? (body?: Body, options?: Prettify<Param & TreatyParam>) => Promise<TreatyResponse<ReplaceGeneratorWithAsyncGenerator<Res>>> : (body: Body, options?: Prettify<Param & TreatyParam>) => Promise<TreatyResponse<ReplaceGeneratorWithAsyncGenerator<Res>>> : K extends 'get' | 'head' ? (options: Prettify<Param & TreatyParam>) => Promise<TreatyResponse<ReplaceGeneratorWithAsyncGenerator<Res>>> : (body: Body, options: Prettify<Param & TreatyParam>) => Promise<TreatyResponse<ReplaceGeneratorWithAsyncGenerator<Res>>> : never : CreateParams<Route[K]>;
+        } ? MaybeEmptyObject<Headers, 'headers'> & MaybeEmptyObject<Query, 'query'> extends infer Param ? {} extends Param ? undefined extends Body ? K extends 'get' | 'head' ? (options?: Prettify<Param & TreatyParam>) => Promise<TreatyResponse<ReplaceGeneratorWithAsyncGenerator<Res>>> : (body?: RelaxFileArrays<Body>, options?: Prettify<Param & TreatyParam>) => Promise<TreatyResponse<ReplaceGeneratorWithAsyncGenerator<Res>>> : K extends 'get' | 'head' ? (options?: Prettify<Param & TreatyParam>) => Promise<TreatyResponse<ReplaceGeneratorWithAsyncGenerator<Res>>> : {} extends Body ? (body?: RelaxFileArrays<Body>, options?: Prettify<Param & TreatyParam>) => Promise<TreatyResponse<ReplaceGeneratorWithAsyncGenerator<Res>>> : (body: RelaxFileArrays<Body>, options?: Prettify<Param & TreatyParam>) => Promise<TreatyResponse<ReplaceGeneratorWithAsyncGenerator<Res>>> : K extends 'get' | 'head' ? (options: Prettify<Param & TreatyParam>) => Promise<TreatyResponse<ReplaceGeneratorWithAsyncGenerator<Res>>> : (body: RelaxFileArrays<Body>, options: Prettify<Param & TreatyParam>) => Promise<TreatyResponse<ReplaceGeneratorWithAsyncGenerator<Res>>> : never : CreateParams<Route[K]>;
     };
     type CreateParams<Route extends Record<string, any>> = Extract<keyof Route, `:${string}`> extends infer Path extends string ? IsNever<Path> extends true ? Prettify<Sign<Route>> : // ! DO NOT USE PRETTIFY ON THIS LINE, OTHERWISE FUNCTION CALLING WILL BE OMITTED
     (((params: {
diff --git a/dist/treaty2.d.ts b/dist/treaty2.d.ts
index 126c58f208c76320da7f74e90ed8c80e1907e7ec..a6b78329c8ba3dd0815c4f22f0c4c5b56b9b5877 100644
--- a/dist/treaty2.d.ts
+++ b/dist/treaty2.d.ts
@@ -1,5 +1,6 @@
 import { InputSchema, Elysia, ELYSIA_FORM_DATA } from 'elysia';
 import { P as Prettify, b as MaybeEmptyObject, a as IsNever, N as Not } from './types-BdHMTa_C.js';
+import { BunFile } from 'bun';
 
 declare class EdenWS<in out Schema extends InputSchema<any> = {}> {
     url: string;
@@ -22,6 +23,10 @@ type Enumerate<N extends number, Acc extends number[] = []> = Acc['length'] exte
 type IntegerRange<F extends number, T extends number> = Exclude<Enumerate<T>, Enumerate<F>>;
 type SuccessCodeRange = IntegerRange<200, 300>;
 type MaybeArray<T> = T | T[];
+type MaybeArrayFile<T> = T extends (File | BunFile)[] ? T | File | BunFile : T;
+type RelaxFileArrays<T> = T extends Record<string, unknown> ? {
+    [K in keyof T]: MaybeArrayFile<T[K]>;
+} : T;
 declare namespace Treaty {
     interface TreatyParam {
         fetch?: RequestInit;
@@ -36,7 +41,7 @@ declare namespace Treaty {
             params: any;
             query: infer Query;
             response: infer Res extends Record<number, unknown>;
-        } ? MaybeEmptyObject<Headers, 'headers'> & MaybeEmptyObject<Query, 'query'> extends infer Param ? {} extends Param ? undefined extends Body ? K extends 'get' | 'head' ? (options?: Prettify<Param & TreatyParam>) => Promise<TreatyResponse<ReplaceGeneratorWithAsyncGenerator<Res>>> : (body?: Body, options?: Prettify<Param & TreatyParam>) => Promise<TreatyResponse<ReplaceGeneratorWithAsyncGenerator<Res>>> : K extends 'get' | 'head' ? (options?: Prettify<Param & TreatyParam>) => Promise<TreatyResponse<ReplaceGeneratorWithAsyncGenerator<Res>>> : {} extends Body ? (body?: Body, options?: Prettify<Param & TreatyParam>) => Promise<TreatyResponse<ReplaceGeneratorWithAsyncGenerator<Res>>> : (body: Body, options?: Prettify<Param & TreatyParam>) => Promise<TreatyResponse<ReplaceGeneratorWithAsyncGenerator<Res>>> : K extends 'get' | 'head' ? (options: Prettify<Param & TreatyParam>) => Promise<TreatyResponse<ReplaceGeneratorWithAsyncGenerator<Res>>> : (body: Body, options: Prettify<Param & TreatyParam>) => Promise<TreatyResponse<ReplaceGeneratorWithAsyncGenerator<Res>>> : never : CreateParams<Route[K]>;
+        } ? MaybeEmptyObject<Headers, 'headers'> & MaybeEmptyObject<Query, 'query'> extends infer Param ? {} extends Param ? undefined extends Body ? K extends 'get' | 'head' ? (options?: Prettify<Param & TreatyParam>) => Promise<TreatyResponse<ReplaceGeneratorWithAsyncGenerator<Res>>> : (body?: RelaxFileArrays<Body>, options?: Prettify<Param & TreatyParam>) => Promise<TreatyResponse<ReplaceGeneratorWithAsyncGenerator<Res>>> : K extends 'get' | 'head' ? (options?: Prettify<Param & TreatyParam>) => Promise<TreatyResponse<ReplaceGeneratorWithAsyncGenerator<Res>>> : {} extends Body ? (body?: RelaxFileArrays<Body>, options?: Prettify<Param & TreatyParam>) => Promise<TreatyResponse<ReplaceGeneratorWithAsyncGenerator<Res>>> : (body: RelaxFileArrays<Body>, options?: Prettify<Param & TreatyParam>) => Promise<TreatyResponse<ReplaceGeneratorWithAsyncGenerator<Res>>> : K extends 'get' | 'head' ? (options: Prettify<Param & TreatyParam>) => Promise<TreatyResponse<ReplaceGeneratorWithAsyncGenerator<Res>>> : (body: RelaxFileArrays<Body>, options: Prettify<Param & TreatyParam>) => Promise<TreatyResponse<ReplaceGeneratorWithAsyncGenerator<Res>>> : never : CreateParams<Route[K]>;
     };
     type CreateParams<Route extends Record<string, any>> = Extract<keyof Route, `:${string}`> extends infer Path extends string ? IsNever<Path> extends true ? Prettify<Sign<Route>> : // ! DO NOT USE PRETTIFY ON THIS LINE, OTHERWISE FUNCTION CALLING WILL BE OMITTED
     (((params: {
diff --git a/dist/treaty2.global.js b/dist/treaty2.global.js
index 398288f8092da48c1deee02b66bdaa0c96b31dc3..04b5ea4d9aeee4801eae65a6f7bd368ac5cf2b4c 100644
--- a/dist/treaty2.global.js
+++ b/dist/treaty2.global.js
@@ -1,6 +1,6 @@
-"use strict";var Eden=(()=>{var j=Object.defineProperty;var H=Object.getOwnPropertyDescriptor;var U=Object.getOwnPropertyNames;var V=Object.prototype.hasOwnProperty;var $=(e,t)=>{for(var n in t)j(e,n,{get:t[n],enumerable:!0})},B=(e,t,n,s)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of U(t))!V.call(e,o)&&o!==n&&j(e,o,{get:()=>t[o],enumerable:!(s=H(t,o))||s.enumerable});return e};var Z=e=>B(j({},"__esModule",{value:!0}),e);var ie={};$(ie,{streamResponse:()=>J,treaty:()=>re});var k=class extends Error{constructor(n,s){super(s+"");this.status=n;this.value=s}};var G=/(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))/,z=/(?:Sun|Mon|Tue|Wed|Thu|Fri|Sat)\s(?:Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s\d{2}\s\d{4}\s\d{2}:\d{2}:\d{2}\sGMT(?:\+|-)\d{4}\s\([^)]+\)/,Q=/^(?:(?:(?:(?:0?[1-9]|[12][0-9]|3[01])[/\s-](?:0?[1-9]|1[0-2])[/\s-](?:19|20)\d{2})|(?:(?:19|20)\d{2}[/\s-](?:0?[1-9]|1[0-2])[/\s-](?:0?[1-9]|[12][0-9]|3[01]))))(?:\s(?:1[012]|0?[1-9]):[0-5][0-9](?::[0-5][0-9])?(?:\s[AP]M)?)?$/,X=e=>e.trim().length!==0&&!Number.isNaN(Number(e)),F=e=>{if(typeof e!="string")return null;let t=e.replace(/"/g,"");if(G.test(t)||z.test(t)||Q.test(t)){let n=new Date(t);if(!Number.isNaN(n.getTime()))return n}return null},Y=e=>{let t=e.charCodeAt(0),n=e.charCodeAt(e.length-1);return t===123&&n===125||t===91&&n===93},ee=e=>JSON.parse(e,(t,n)=>{let s=F(n);return s||n}),A=e=>{if(!e)return e;if(X(e))return+e;if(e==="true")return!0;if(e==="false")return!1;let t=F(e);if(t)return t;if(Y(e))try{return ee(e)}catch{}return e},D=e=>{let t=e.data.toString();return t==="null"?null:A(t)};var M=class{constructor(t){this.url=t;this.ws=new WebSocket(t)}ws;send(t){return Array.isArray(t)?(t.forEach(n=>this.send(n)),this):(this.ws.send(typeof t=="object"?JSON.stringify(t):t.toString()),this)}on(t,n,s){return this.addEventListener(t,n,s)}off(t,n,s){return this.ws.removeEventListener(t,n,s),this}subscribe(t,n){return this.addEventListener("message",t,n)}addEventListener(t,n,s){return this.ws.addEventListener(t,o=>{if(t==="message"){let c=D(o);n({...o,data:c})}else n(o)},s),this}removeEventListener(t,n,s){return this.off(t,n,s),this}close(){return this.ws.close(),this}};var te=["get","post","put","delete","patch","options","head","connect","subscribe"],I=["localhost","127.0.0.1","0.0.0.0"],C=typeof FileList>"u",q=e=>C?e instanceof Blob:e instanceof FileList||e instanceof File,ne=e=>{if(!e)return!1;for(let t in e)if(q(e[t])||Array.isArray(e[t])&&e[t].find(q))return!0;return!1},N=e=>C?e:new Promise(t=>{let n=new FileReader;n.onload=()=>{let s=new File([n.result],e.name,{lastModified:e.lastModified,type:e.type});t(s)},n.readAsArrayBuffer(e)}),S=(e,t,n={},s={})=>{if(Array.isArray(e)){for(let o of e)if(!Array.isArray(o))s=S(o,t,n,s);else{let c=o[0];if(typeof c=="string")s[c.toLowerCase()]=o[1];else for(let[i,g]of c)s[i.toLowerCase()]=g}return s}if(!e)return s;switch(typeof e){case"function":if(e instanceof Headers)return S(e,t,n,s);let o=e(t,n);return o?S(o,t,n,s):s;case"object":if(e instanceof Headers)return e.forEach((c,i)=>{s[i.toLowerCase()]=c}),s;for(let[c,i]of Object.entries(e))s[c.toLowerCase()]=i;return s;default:return s}};async function*J(e){let t=e.body;if(!t)return;let n=t.getReader(),s=new TextDecoder;try{for(;;){let{done:o,value:c}=await n.read();if(o)break;let i=typeof c=="string"?c:s.decode(c);i.includes(`
+"use strict";var Eden=(()=>{var K=Object.defineProperty;var B=Object.getOwnPropertyDescriptor;var Z=Object.getOwnPropertyNames;var G=Object.prototype.hasOwnProperty;var z=(e,t)=>{for(var n in t)K(e,n,{get:t[n],enumerable:!0})},Q=(e,t,n,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let a of Z(t))!G.call(e,a)&&a!==n&&K(e,a,{get:()=>t[a],enumerable:!(r=B(t,a))||r.enumerable});return e};var X=e=>Q(K({},"__esModule",{value:!0}),e);var fe={};z(fe,{streamResponse:()=>V,treaty:()=>ce});var x=class extends Error{constructor(n,r){super(r+"");this.status=n;this.value=r}};var Y=/(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))/,ee=/(?:Sun|Mon|Tue|Wed|Thu|Fri|Sat)\s(?:Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s\d{2}\s\d{4}\s\d{2}:\d{2}:\d{2}\sGMT(?:\+|-)\d{4}\s\([^)]+\)/,te=/^(?:(?:(?:(?:0?[1-9]|[12][0-9]|3[01])[/\s-](?:0?[1-9]|1[0-2])[/\s-](?:19|20)\d{2})|(?:(?:19|20)\d{2}[/\s-](?:0?[1-9]|1[0-2])[/\s-](?:0?[1-9]|[12][0-9]|3[01]))))(?:\s(?:1[012]|0?[1-9]):[0-5][0-9](?::[0-5][0-9])?(?:\s[AP]M)?)?$/,ne=e=>e.trim().length!==0&&!Number.isNaN(Number(e)),M=e=>{if(typeof e!="string")return null;let t=e.replace(/"/g,"");if(Y.test(t)||ee.test(t)||te.test(t)){let n=new Date(t);if(!Number.isNaN(n.getTime()))return n}return null},re=e=>{let t=e.charCodeAt(0),n=e.charCodeAt(e.length-1);return t===123&&n===125||t===91&&n===93},se=e=>JSON.parse(e,(t,n)=>{let r=M(n);return r||n}),O=e=>{if(!e)return e;if(ne(e))return+e;if(e==="true")return!0;if(e==="false")return!1;let t=M(e);if(t)return t;if(re(e))try{return se(e)}catch{}return e},I=e=>{let t=e.data.toString();return t==="null"?null:O(t)};var W=class{constructor(t){this.url=t;this.ws=new WebSocket(t)}ws;send(t){return Array.isArray(t)?(t.forEach(n=>this.send(n)),this):(this.ws.send(typeof t=="object"?JSON.stringify(t):t.toString()),this)}on(t,n,r){return this.addEventListener(t,n,r)}off(t,n,r){return this.ws.removeEventListener(t,n,r),this}subscribe(t,n){return this.addEventListener("message",t,n)}addEventListener(t,n,r){return this.ws.addEventListener(t,a=>{if(t==="message"){let o=I(a);n({...a,data:o})}else n(a)},r),this}removeEventListener(t,n,r){return this.off(t,n,r),this}close(){return this.ws.close(),this}};var ie=["get","post","put","delete","patch","options","head","connect","subscribe"],P=["localhost","127.0.0.1","0.0.0.0"],J=typeof FileList>"u",C=e=>J?e instanceof Blob:e instanceof FileList||e instanceof File,ae=e=>{if(!e)return!1;for(let t in e)if(C(e[t])||Array.isArray(e[t])&&e[t].find(C))return!0;return!1},D=e=>J?e:new Promise(t=>{let n=new FileReader;n.onload=()=>{let r=new File([n.result],e.name,{lastModified:e.lastModified,type:e.type});t(r)},n.readAsArrayBuffer(e)}),k=(e,t,n={},r={})=>{if(Array.isArray(e)){for(let a of e)if(!Array.isArray(a))r=k(a,t,n,r);else{let o=a[0];if(typeof o=="string")r[o.toLowerCase()]=a[1];else for(let[i,g]of o)r[i.toLowerCase()]=g}return r}if(!e)return r;switch(typeof e){case"function":if(e instanceof Headers)return k(e,t,n,r);let a=e(t,n);return a?k(a,t,n,r):r;case"object":if(e instanceof Headers)return e.forEach((o,i)=>{r[i.toLowerCase()]=o}),r;for(let[o,i]of Object.entries(e))r[o.toLowerCase()]=i;return r;default:return r}};async function*V(e){let t=e.body;if(!t)return;let n=t.getReader(),r=new TextDecoder;try{for(;;){let{done:a,value:o}=await n.read();if(a)break;let i=typeof o=="string"?o:r.decode(o);i.includes(`
 
-`)?yield*se(i):yield A(i)}}finally{n.releaseLock()}}function*se(e){let t=e.split(`
+`)?yield*oe(i):yield O(i)}}finally{n.releaseLock()}}function*oe(e){let t=e.split(`
 
-`);for(let n of t){if(n.indexOf(":")<=0){n&&(yield A(n));continue}let s=n.split(`
-`),o={};for(let c of s){let i=c.indexOf(":");if(i>0){let g=c.slice(0,i).trim(),L=c.slice(i+1).trim();o[g]=A(L)}}yield o}}var O=(e,t,n=[],s)=>new Proxy(()=>{},{get(o,c){return O(e,t,c==="index"?n:[...n,c],s)},apply(o,c,[i,g]){if(!i||g||typeof i=="object"&&Object.keys(i).length!==1||te.includes(n.at(-1))){let L=[...n],E=L.pop(),m="/"+L.join("/"),{fetcher:P=fetch,headers:R,onRequest:h,onResponse:v,fetch:_}=t,w=E==="get"||E==="head"||E==="subscribe";R=S(R,m,g);let K=w?i?.query:g?.query,T="";if(K){let r=(b,l)=>{T+=(T?"&":"?")+`${encodeURIComponent(b)}=${encodeURIComponent(l)}`};for(let[b,l]of Object.entries(K)){if(Array.isArray(l)){for(let d of l)r(b,d);continue}if(l!=null){if(typeof l=="object"){r(b,JSON.stringify(l));continue}r(b,`${l}`)}}}if(E==="subscribe"){let r=e.replace(/^([^]+):\/\//,e.startsWith("https://")?"wss://":e.startsWith("http://")||I.find(b=>e.includes(b))?"ws://":"wss://")+m+T;return new M(r)}return(async()=>{let r={method:E?.toUpperCase(),body:i,..._,headers:R};r.headers={...R,...S(w?i?.headers:g?.headers,m,r)};let b=w&&typeof i=="object"?i.fetch:g?.fetch;if(r={...r,...b},w&&delete r.body,h){Array.isArray(h)||(h=[h]);for(let u of h){let a=await u(m,r);typeof a=="object"&&(r={...r,...a,headers:{...r.headers,...S(a.headers,m,r)}})}}if(w&&delete r.body,ne(i)){let u=new FormData;for(let[a,f]of Object.entries(r.body)){if(Array.isArray(f)){for(let p=0;p<f.length;p++){let W=f[p];u.append(a,W instanceof File?await N(W):W)}continue}if(C){if(Array.isArray(f))for(let p of f)u.append(a,p);else u.append(a,f);continue}if(f instanceof File){u.append(a,await N(f));continue}if(f instanceof FileList){for(let p=0;p<f.length;p++)u.append(a,await N(f[p]));continue}u.append(a,f)}r.body=u}else typeof i=="object"?(r.headers["content-type"]="application/json",r.body=JSON.stringify(i)):i!=null&&(r.headers["content-type"]="text/plain");if(w&&delete r.body,h){Array.isArray(h)||(h=[h]);for(let u of h){let a=await u(m,r);typeof a=="object"&&(r={...r,...a,headers:{...r.headers,...S(a.headers,m,r)}})}}g?.headers?.["content-type"]&&(r.headers["content-type"]=g?.headers["content-type"]);let l=e+m+T,d=await(s?.handle(new Request(l,r))??P(l,r)),y=null,x=null;if(v){Array.isArray(v)||(v=[v]);for(let u of v)try{let a=await u(d.clone());if(a!=null){y=a;break}}catch(a){a instanceof k?x=a:x=new k(422,a);break}}if(y!==null)return{data:y,error:x,response:d,status:d.status,headers:d.headers};switch(d.headers.get("Content-Type")?.split(";")[0]){case"text/event-stream":y=J(d);break;case"application/json":y=JSON.parse(await d.text(),(a,f)=>{if(typeof f!="string")return f;let p=F(f);return p||f});break;case"application/octet-stream":y=await d.arrayBuffer();break;case"multipart/form-data":let u=await d.formData();y={},u.forEach((a,f)=>{y[f]=a});break;default:y=await d.text().then(A)}return(d.status>=300||d.status<200)&&(x=new k(d.status,y),y=null),{data:y,error:x,response:d,status:d.status,headers:d.headers}})()}return typeof i=="object"?O(e,t,[...n,Object.values(i)[0]],s):O(e,t,n)}}),re=(e,t={})=>typeof e=="string"?(t.keepDomain||(e.includes("://")||(e=(I.find(n=>e.includes(n))?"http://":"https://")+e),e.endsWith("/")&&(e=e.slice(0,-1))),O(e,t)):(typeof window<"u"&&console.warn("Elysia instance server found on client side, this is not recommended for security reason. Use generic type instead."),O("http://e.ly",t,[],e));return Z(ie);})();
+`);for(let n of t){if(n.indexOf(":")<=0){n&&(yield O(n));continue}let r=n.split(`
+`),a={};for(let o of r){let i=o.indexOf(":");if(i>0){let g=o.slice(0,i).trim(),N=o.slice(i+1).trim();a[g]=O(N)}}yield a}}var L=(e,t,n=[],r)=>new Proxy(()=>{},{get(a,o){return L(e,t,o==="index"?n:[...n,o],r)},apply(a,o,[i,g]){if(!i||g||typeof i=="object"&&Object.keys(i).length!==1||ie.includes(n.at(-1))){let N=[...n],v=N.pop(),S="/"+N.join("/"),{fetcher:_=fetch,headers:R,onRequest:b,onResponse:j,fetch:H}=t,A=v==="get"||v==="head"||v==="subscribe";R=k(R,S,g);let q=A?i?.query:g?.query,T="";if(q){let s=(w,y)=>{T+=(T?"&":"?")+`${encodeURIComponent(w)}=${encodeURIComponent(y)}`};for(let[w,y]of Object.entries(q)){if(Array.isArray(y)){for(let d of y)s(w,d);continue}if(y!=null){if(typeof y=="object"){s(w,JSON.stringify(y));continue}s(w,`${y}`)}}}if(v==="subscribe"){let s=e.replace(/^([^]+):\/\//,e.startsWith("https://")?"wss://":e.startsWith("http://")||P.find(w=>e.includes(w))?"ws://":"wss://")+S+T;return new W(s)}return(async()=>{let s={method:v?.toUpperCase(),body:i,...H,headers:R};s.headers={...R,...k(A?i?.headers:g?.headers,S,s)};let w=A&&typeof i=="object"?i.fetch:g?.fetch;if(s={...s,...w},A&&delete s.body,b){Array.isArray(b)||(b=[b]);for(let u of b){let f=await u(S,s);typeof f=="object"&&(s={...s,...f,headers:{...s.headers,...k(f.headers,S,s)}})}}if(A&&delete s.body,ae(i)){let u=new FormData,f=c=>typeof c=="string"||C(c)?!1:typeof c=="object"&&c!==null,h=async c=>c instanceof File?await D(c):f(c)?JSON.stringify(c):c;for(let[c,l]of Object.entries(s.body)){if(Array.isArray(l)){if(l.some(m=>typeof m=="object"&&m!==null&&!C(m)))u.append(c,JSON.stringify(l));else for(let m=0;m<l.length;m++){let U=l[m],$=await h(U);u.append(c,$)}continue}if(J){if(Array.isArray(l))for(let E of l)u.append(c,await h(E));else u.append(c,await h(l));continue}if(l instanceof File){u.append(c,await D(l));continue}if(l instanceof FileList){for(let E=0;E<l.length;E++)u.append(c,await D(l[E]));continue}u.append(c,await h(l))}s.body=u}else typeof i=="object"?(s.headers["content-type"]="application/json",s.body=JSON.stringify(i)):i!=null&&(s.headers["content-type"]="text/plain");if(A&&delete s.body,b){Array.isArray(b)||(b=[b]);for(let u of b){let f=await u(S,s);typeof f=="object"&&(s={...s,...f,headers:{...s.headers,...k(f.headers,S,s)}})}}g?.headers?.["content-type"]&&(s.headers["content-type"]=g?.headers["content-type"]);let y=e+S+T,d=await(r?.handle(new Request(y,s))??_(y,s)),p=null,F=null;if(j){Array.isArray(j)||(j=[j]);for(let u of j)try{let f=await u(d.clone());if(f!=null){p=f;break}}catch(f){f instanceof x?F=f:F=new x(422,f);break}}if(p!==null)return{data:p,error:F,response:d,status:d.status,headers:d.headers};switch(d.headers.get("Content-Type")?.split(";")[0]){case"text/event-stream":p=V(d);break;case"application/json":p=JSON.parse(await d.text(),(f,h)=>{if(typeof h!="string")return h;let c=M(h);return c||h});break;case"application/octet-stream":p=await d.arrayBuffer();break;case"multipart/form-data":let u=await d.formData();p={},u.forEach((f,h)=>{p[h]=f});break;default:p=await d.text().then(O)}return(d.status>=300||d.status<200)&&(F=new x(d.status,p),p=null),{data:p,error:F,response:d,status:d.status,headers:d.headers}})()}return typeof i=="object"?L(e,t,[...n,Object.values(i)[0]],r):L(e,t,n)}}),ce=(e,t={})=>typeof e=="string"?(t.keepDomain||(e.includes("://")||(e=(P.find(n=>e.includes(n))?"http://":"https://")+e),e.endsWith("/")&&(e=e.slice(0,-1))),L(e,t)):(typeof window<"u"&&console.warn("Elysia instance server found on client side, this is not recommended for security reason. Use generic type instead."),L("http://e.ly",t,[],e));return X(fe);})();
diff --git a/dist/treaty2.js b/dist/treaty2.js
index d7d090c9083543d5ad6b28b3cfdd9ca030decd48..6bd7662860d02e149456fc39371456f686f2f963 100644
--- a/dist/treaty2.js
+++ b/dist/treaty2.js
@@ -1,6 +1,6 @@
-"use strict";var j=Object.defineProperty;var H=Object.getOwnPropertyDescriptor;var U=Object.getOwnPropertyNames;var V=Object.prototype.hasOwnProperty;var $=(e,t)=>{for(var n in t)j(e,n,{get:t[n],enumerable:!0})},B=(e,t,n,s)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of U(t))!V.call(e,o)&&o!==n&&j(e,o,{get:()=>t[o],enumerable:!(s=H(t,o))||s.enumerable});return e};var Z=e=>B(j({},"__esModule",{value:!0}),e);var ie={};$(ie,{streamResponse:()=>J,treaty:()=>re});module.exports=Z(ie);var k=class extends Error{constructor(n,s){super(s+"");this.status=n;this.value=s}};var G=/(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))/,z=/(?:Sun|Mon|Tue|Wed|Thu|Fri|Sat)\s(?:Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s\d{2}\s\d{4}\s\d{2}:\d{2}:\d{2}\sGMT(?:\+|-)\d{4}\s\([^)]+\)/,Q=/^(?:(?:(?:(?:0?[1-9]|[12][0-9]|3[01])[/\s-](?:0?[1-9]|1[0-2])[/\s-](?:19|20)\d{2})|(?:(?:19|20)\d{2}[/\s-](?:0?[1-9]|1[0-2])[/\s-](?:0?[1-9]|[12][0-9]|3[01]))))(?:\s(?:1[012]|0?[1-9]):[0-5][0-9](?::[0-5][0-9])?(?:\s[AP]M)?)?$/,X=e=>e.trim().length!==0&&!Number.isNaN(Number(e)),F=e=>{if(typeof e!="string")return null;let t=e.replace(/"/g,"");if(G.test(t)||z.test(t)||Q.test(t)){let n=new Date(t);if(!Number.isNaN(n.getTime()))return n}return null},Y=e=>{let t=e.charCodeAt(0),n=e.charCodeAt(e.length-1);return t===123&&n===125||t===91&&n===93},ee=e=>JSON.parse(e,(t,n)=>{let s=F(n);return s||n}),A=e=>{if(!e)return e;if(X(e))return+e;if(e==="true")return!0;if(e==="false")return!1;let t=F(e);if(t)return t;if(Y(e))try{return ee(e)}catch{}return e},D=e=>{let t=e.data.toString();return t==="null"?null:A(t)};var M=class{constructor(t){this.url=t;this.ws=new WebSocket(t)}ws;send(t){return Array.isArray(t)?(t.forEach(n=>this.send(n)),this):(this.ws.send(typeof t=="object"?JSON.stringify(t):t.toString()),this)}on(t,n,s){return this.addEventListener(t,n,s)}off(t,n,s){return this.ws.removeEventListener(t,n,s),this}subscribe(t,n){return this.addEventListener("message",t,n)}addEventListener(t,n,s){return this.ws.addEventListener(t,o=>{if(t==="message"){let c=D(o);n({...o,data:c})}else n(o)},s),this}removeEventListener(t,n,s){return this.off(t,n,s),this}close(){return this.ws.close(),this}};var te=["get","post","put","delete","patch","options","head","connect","subscribe"],I=["localhost","127.0.0.1","0.0.0.0"],C=typeof FileList>"u",q=e=>C?e instanceof Blob:e instanceof FileList||e instanceof File,ne=e=>{if(!e)return!1;for(let t in e)if(q(e[t])||Array.isArray(e[t])&&e[t].find(q))return!0;return!1},N=e=>C?e:new Promise(t=>{let n=new FileReader;n.onload=()=>{let s=new File([n.result],e.name,{lastModified:e.lastModified,type:e.type});t(s)},n.readAsArrayBuffer(e)}),S=(e,t,n={},s={})=>{if(Array.isArray(e)){for(let o of e)if(!Array.isArray(o))s=S(o,t,n,s);else{let c=o[0];if(typeof c=="string")s[c.toLowerCase()]=o[1];else for(let[i,g]of c)s[i.toLowerCase()]=g}return s}if(!e)return s;switch(typeof e){case"function":if(e instanceof Headers)return S(e,t,n,s);let o=e(t,n);return o?S(o,t,n,s):s;case"object":if(e instanceof Headers)return e.forEach((c,i)=>{s[i.toLowerCase()]=c}),s;for(let[c,i]of Object.entries(e))s[c.toLowerCase()]=i;return s;default:return s}};async function*J(e){let t=e.body;if(!t)return;let n=t.getReader(),s=new TextDecoder;try{for(;;){let{done:o,value:c}=await n.read();if(o)break;let i=typeof c=="string"?c:s.decode(c);i.includes(`
+"use strict";var K=Object.defineProperty;var B=Object.getOwnPropertyDescriptor;var Z=Object.getOwnPropertyNames;var G=Object.prototype.hasOwnProperty;var z=(e,t)=>{for(var n in t)K(e,n,{get:t[n],enumerable:!0})},Q=(e,t,n,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let a of Z(t))!G.call(e,a)&&a!==n&&K(e,a,{get:()=>t[a],enumerable:!(r=B(t,a))||r.enumerable});return e};var X=e=>Q(K({},"__esModule",{value:!0}),e);var fe={};z(fe,{streamResponse:()=>V,treaty:()=>ce});module.exports=X(fe);var x=class extends Error{constructor(n,r){super(r+"");this.status=n;this.value=r}};var Y=/(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))/,ee=/(?:Sun|Mon|Tue|Wed|Thu|Fri|Sat)\s(?:Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s\d{2}\s\d{4}\s\d{2}:\d{2}:\d{2}\sGMT(?:\+|-)\d{4}\s\([^)]+\)/,te=/^(?:(?:(?:(?:0?[1-9]|[12][0-9]|3[01])[/\s-](?:0?[1-9]|1[0-2])[/\s-](?:19|20)\d{2})|(?:(?:19|20)\d{2}[/\s-](?:0?[1-9]|1[0-2])[/\s-](?:0?[1-9]|[12][0-9]|3[01]))))(?:\s(?:1[012]|0?[1-9]):[0-5][0-9](?::[0-5][0-9])?(?:\s[AP]M)?)?$/,ne=e=>e.trim().length!==0&&!Number.isNaN(Number(e)),M=e=>{if(typeof e!="string")return null;let t=e.replace(/"/g,"");if(Y.test(t)||ee.test(t)||te.test(t)){let n=new Date(t);if(!Number.isNaN(n.getTime()))return n}return null},re=e=>{let t=e.charCodeAt(0),n=e.charCodeAt(e.length-1);return t===123&&n===125||t===91&&n===93},se=e=>JSON.parse(e,(t,n)=>{let r=M(n);return r||n}),O=e=>{if(!e)return e;if(ne(e))return+e;if(e==="true")return!0;if(e==="false")return!1;let t=M(e);if(t)return t;if(re(e))try{return se(e)}catch{}return e},I=e=>{let t=e.data.toString();return t==="null"?null:O(t)};var W=class{constructor(t){this.url=t;this.ws=new WebSocket(t)}ws;send(t){return Array.isArray(t)?(t.forEach(n=>this.send(n)),this):(this.ws.send(typeof t=="object"?JSON.stringify(t):t.toString()),this)}on(t,n,r){return this.addEventListener(t,n,r)}off(t,n,r){return this.ws.removeEventListener(t,n,r),this}subscribe(t,n){return this.addEventListener("message",t,n)}addEventListener(t,n,r){return this.ws.addEventListener(t,a=>{if(t==="message"){let o=I(a);n({...a,data:o})}else n(a)},r),this}removeEventListener(t,n,r){return this.off(t,n,r),this}close(){return this.ws.close(),this}};var ie=["get","post","put","delete","patch","options","head","connect","subscribe"],P=["localhost","127.0.0.1","0.0.0.0"],J=typeof FileList>"u",C=e=>J?e instanceof Blob:e instanceof FileList||e instanceof File,ae=e=>{if(!e)return!1;for(let t in e)if(C(e[t])||Array.isArray(e[t])&&e[t].find(C))return!0;return!1},D=e=>J?e:new Promise(t=>{let n=new FileReader;n.onload=()=>{let r=new File([n.result],e.name,{lastModified:e.lastModified,type:e.type});t(r)},n.readAsArrayBuffer(e)}),k=(e,t,n={},r={})=>{if(Array.isArray(e)){for(let a of e)if(!Array.isArray(a))r=k(a,t,n,r);else{let o=a[0];if(typeof o=="string")r[o.toLowerCase()]=a[1];else for(let[i,g]of o)r[i.toLowerCase()]=g}return r}if(!e)return r;switch(typeof e){case"function":if(e instanceof Headers)return k(e,t,n,r);let a=e(t,n);return a?k(a,t,n,r):r;case"object":if(e instanceof Headers)return e.forEach((o,i)=>{r[i.toLowerCase()]=o}),r;for(let[o,i]of Object.entries(e))r[o.toLowerCase()]=i;return r;default:return r}};async function*V(e){let t=e.body;if(!t)return;let n=t.getReader(),r=new TextDecoder;try{for(;;){let{done:a,value:o}=await n.read();if(a)break;let i=typeof o=="string"?o:r.decode(o);i.includes(`
 
-`)?yield*se(i):yield A(i)}}finally{n.releaseLock()}}function*se(e){let t=e.split(`
+`)?yield*oe(i):yield O(i)}}finally{n.releaseLock()}}function*oe(e){let t=e.split(`
 
-`);for(let n of t){if(n.indexOf(":")<=0){n&&(yield A(n));continue}let s=n.split(`
-`),o={};for(let c of s){let i=c.indexOf(":");if(i>0){let g=c.slice(0,i).trim(),L=c.slice(i+1).trim();o[g]=A(L)}}yield o}}var O=(e,t,n=[],s)=>new Proxy(()=>{},{get(o,c){return O(e,t,c==="index"?n:[...n,c],s)},apply(o,c,[i,g]){if(!i||g||typeof i=="object"&&Object.keys(i).length!==1||te.includes(n.at(-1))){let L=[...n],E=L.pop(),m="/"+L.join("/"),{fetcher:P=fetch,headers:R,onRequest:h,onResponse:v,fetch:_}=t,w=E==="get"||E==="head"||E==="subscribe";R=S(R,m,g);let K=w?i?.query:g?.query,T="";if(K){let r=(b,l)=>{T+=(T?"&":"?")+`${encodeURIComponent(b)}=${encodeURIComponent(l)}`};for(let[b,l]of Object.entries(K)){if(Array.isArray(l)){for(let d of l)r(b,d);continue}if(l!=null){if(typeof l=="object"){r(b,JSON.stringify(l));continue}r(b,`${l}`)}}}if(E==="subscribe"){let r=e.replace(/^([^]+):\/\//,e.startsWith("https://")?"wss://":e.startsWith("http://")||I.find(b=>e.includes(b))?"ws://":"wss://")+m+T;return new M(r)}return(async()=>{let r={method:E?.toUpperCase(),body:i,..._,headers:R};r.headers={...R,...S(w?i?.headers:g?.headers,m,r)};let b=w&&typeof i=="object"?i.fetch:g?.fetch;if(r={...r,...b},w&&delete r.body,h){Array.isArray(h)||(h=[h]);for(let u of h){let a=await u(m,r);typeof a=="object"&&(r={...r,...a,headers:{...r.headers,...S(a.headers,m,r)}})}}if(w&&delete r.body,ne(i)){let u=new FormData;for(let[a,f]of Object.entries(r.body)){if(Array.isArray(f)){for(let p=0;p<f.length;p++){let W=f[p];u.append(a,W instanceof File?await N(W):W)}continue}if(C){if(Array.isArray(f))for(let p of f)u.append(a,p);else u.append(a,f);continue}if(f instanceof File){u.append(a,await N(f));continue}if(f instanceof FileList){for(let p=0;p<f.length;p++)u.append(a,await N(f[p]));continue}u.append(a,f)}r.body=u}else typeof i=="object"?(r.headers["content-type"]="application/json",r.body=JSON.stringify(i)):i!=null&&(r.headers["content-type"]="text/plain");if(w&&delete r.body,h){Array.isArray(h)||(h=[h]);for(let u of h){let a=await u(m,r);typeof a=="object"&&(r={...r,...a,headers:{...r.headers,...S(a.headers,m,r)}})}}g?.headers?.["content-type"]&&(r.headers["content-type"]=g?.headers["content-type"]);let l=e+m+T,d=await(s?.handle(new Request(l,r))??P(l,r)),y=null,x=null;if(v){Array.isArray(v)||(v=[v]);for(let u of v)try{let a=await u(d.clone());if(a!=null){y=a;break}}catch(a){a instanceof k?x=a:x=new k(422,a);break}}if(y!==null)return{data:y,error:x,response:d,status:d.status,headers:d.headers};switch(d.headers.get("Content-Type")?.split(";")[0]){case"text/event-stream":y=J(d);break;case"application/json":y=JSON.parse(await d.text(),(a,f)=>{if(typeof f!="string")return f;let p=F(f);return p||f});break;case"application/octet-stream":y=await d.arrayBuffer();break;case"multipart/form-data":let u=await d.formData();y={},u.forEach((a,f)=>{y[f]=a});break;default:y=await d.text().then(A)}return(d.status>=300||d.status<200)&&(x=new k(d.status,y),y=null),{data:y,error:x,response:d,status:d.status,headers:d.headers}})()}return typeof i=="object"?O(e,t,[...n,Object.values(i)[0]],s):O(e,t,n)}}),re=(e,t={})=>typeof e=="string"?(t.keepDomain||(e.includes("://")||(e=(I.find(n=>e.includes(n))?"http://":"https://")+e),e.endsWith("/")&&(e=e.slice(0,-1))),O(e,t)):(typeof window<"u"&&console.warn("Elysia instance server found on client side, this is not recommended for security reason. Use generic type instead."),O("http://e.ly",t,[],e));0&&(module.exports={streamResponse,treaty});
+`);for(let n of t){if(n.indexOf(":")<=0){n&&(yield O(n));continue}let r=n.split(`
+`),a={};for(let o of r){let i=o.indexOf(":");if(i>0){let g=o.slice(0,i).trim(),N=o.slice(i+1).trim();a[g]=O(N)}}yield a}}var L=(e,t,n=[],r)=>new Proxy(()=>{},{get(a,o){return L(e,t,o==="index"?n:[...n,o],r)},apply(a,o,[i,g]){if(!i||g||typeof i=="object"&&Object.keys(i).length!==1||ie.includes(n.at(-1))){let N=[...n],v=N.pop(),S="/"+N.join("/"),{fetcher:_=fetch,headers:R,onRequest:b,onResponse:j,fetch:H}=t,A=v==="get"||v==="head"||v==="subscribe";R=k(R,S,g);let q=A?i?.query:g?.query,T="";if(q){let s=(w,y)=>{T+=(T?"&":"?")+`${encodeURIComponent(w)}=${encodeURIComponent(y)}`};for(let[w,y]of Object.entries(q)){if(Array.isArray(y)){for(let d of y)s(w,d);continue}if(y!=null){if(typeof y=="object"){s(w,JSON.stringify(y));continue}s(w,`${y}`)}}}if(v==="subscribe"){let s=e.replace(/^([^]+):\/\//,e.startsWith("https://")?"wss://":e.startsWith("http://")||P.find(w=>e.includes(w))?"ws://":"wss://")+S+T;return new W(s)}return(async()=>{let s={method:v?.toUpperCase(),body:i,...H,headers:R};s.headers={...R,...k(A?i?.headers:g?.headers,S,s)};let w=A&&typeof i=="object"?i.fetch:g?.fetch;if(s={...s,...w},A&&delete s.body,b){Array.isArray(b)||(b=[b]);for(let u of b){let f=await u(S,s);typeof f=="object"&&(s={...s,...f,headers:{...s.headers,...k(f.headers,S,s)}})}}if(A&&delete s.body,ae(i)){let u=new FormData,f=c=>typeof c=="string"||C(c)?!1:typeof c=="object"&&c!==null,h=async c=>c instanceof File?await D(c):f(c)?JSON.stringify(c):c;for(let[c,l]of Object.entries(s.body)){if(Array.isArray(l)){if(l.some(m=>typeof m=="object"&&m!==null&&!C(m)))u.append(c,JSON.stringify(l));else for(let m=0;m<l.length;m++){let U=l[m],$=await h(U);u.append(c,$)}continue}if(J){if(Array.isArray(l))for(let E of l)u.append(c,await h(E));else u.append(c,await h(l));continue}if(l instanceof File){u.append(c,await D(l));continue}if(l instanceof FileList){for(let E=0;E<l.length;E++)u.append(c,await D(l[E]));continue}u.append(c,await h(l))}s.body=u}else typeof i=="object"?(s.headers["content-type"]="application/json",s.body=JSON.stringify(i)):i!=null&&(s.headers["content-type"]="text/plain");if(A&&delete s.body,b){Array.isArray(b)||(b=[b]);for(let u of b){let f=await u(S,s);typeof f=="object"&&(s={...s,...f,headers:{...s.headers,...k(f.headers,S,s)}})}}g?.headers?.["content-type"]&&(s.headers["content-type"]=g?.headers["content-type"]);let y=e+S+T,d=await(r?.handle(new Request(y,s))??_(y,s)),p=null,F=null;if(j){Array.isArray(j)||(j=[j]);for(let u of j)try{let f=await u(d.clone());if(f!=null){p=f;break}}catch(f){f instanceof x?F=f:F=new x(422,f);break}}if(p!==null)return{data:p,error:F,response:d,status:d.status,headers:d.headers};switch(d.headers.get("Content-Type")?.split(";")[0]){case"text/event-stream":p=V(d);break;case"application/json":p=JSON.parse(await d.text(),(f,h)=>{if(typeof h!="string")return h;let c=M(h);return c||h});break;case"application/octet-stream":p=await d.arrayBuffer();break;case"multipart/form-data":let u=await d.formData();p={},u.forEach((f,h)=>{p[h]=f});break;default:p=await d.text().then(O)}return(d.status>=300||d.status<200)&&(F=new x(d.status,p),p=null),{data:p,error:F,response:d,status:d.status,headers:d.headers}})()}return typeof i=="object"?L(e,t,[...n,Object.values(i)[0]],r):L(e,t,n)}}),ce=(e,t={})=>typeof e=="string"?(t.keepDomain||(e.includes("://")||(e=(P.find(n=>e.includes(n))?"http://":"https://")+e),e.endsWith("/")&&(e=e.slice(0,-1))),L(e,t)):(typeof window<"u"&&console.warn("Elysia instance server found on client side, this is not recommended for security reason. Use generic type instead."),L("http://e.ly",t,[],e));0&&(module.exports={streamResponse,treaty});
diff --git a/dist/treaty2.mjs b/dist/treaty2.mjs
index 808fe1aa4a5d7d6ec3df2a84eb0fd26c51d86796..dbd3b2465cb4ed572d00eafd167cca903f938a86 100644
--- a/dist/treaty2.mjs
+++ b/dist/treaty2.mjs
@@ -1 +1 @@
-import{a,b}from"./chunk-LJDYVDXQ.mjs";import"./chunk-QSLHAOSM.mjs";export{a as streamResponse,b as treaty};
+import{a,b}from"./chunk-YANFU6C4.mjs";import"./chunk-QSLHAOSM.mjs";export{a as streamResponse,b as treaty};
